<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>ğŸ§¬ å½¥å½¬ è‡ªæª¢è¡¨ç³»çµ±</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
tailwind.config={theme:{extend:{colors:{primary:'#008C76',secondary:'#E8F9F7',accent:'#FFD700',dark:'#1A202C',lightBg:'#F9FAFB',neutral:'#F3F4F6',cardBg:'#FFFFFF',textPrimary:'#1E293B',textSecondary:'#64748B'},fontFamily:{sans:['Noto Sans TC','sans-serif','system-ui'],display:['Noto Sans TC','sans-serif','system-ui']},boxShadow:{'elevation-1':'0 2px 8px rgba(0,0,0,0.06)','elevation-2':'0 4px 16px rgba(0,0,0,0.08)','elevation-3':'0 8px 24px rgba(0,0,0,0.12)','elevation-hover':'0 12px 32px rgba(0,0,0,0.15)'}}}};
</script>
<style type="text/tailwindcss">
@layer utilities{.fade-in{animation:fadeIn 0.6s cubic-bezier(0.4,0,0.2,1);}.slide-up{animation:slideUp 0.5s cubic-bezier(0.34,1.56,0.64,1);}.scale-in{animation:scaleIn 0.4s cubic-bezier(0.34,1.56,0.64,1);}.pulse-subtle{animation:pulseSubtle 2s infinite;}.gradient-text{background-clip:text;-webkit-background-clip:text;color:transparent;}.card-hover{transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);}.btn-hover{transition:all 0.25s cubic-bezier(0.34,1.56,0.64,1);}.factor-tag{font-size:0.75rem;padding:0.2rem 0.4rem;border-radius:6px;font-weight:500;}.input-focus{@apply focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all;}}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes slideUp{from{transform:translateY(30px);opacity:0;}to{transform:translateY(0);opacity:1;}}
@keyframes scaleIn{from{transform:scale(0.96);opacity:0;}to{transform:scale(1);opacity:1;}}
@keyframes pulseSubtle{0%,100%{opacity:1;}50%{opacity:0.8;}}
::-webkit-scrollbar{width:8px;height:8px;}
::-webkit-scrollbar-track{background:#F1F5F9;border-radius:4px;}
::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:4px;}
::-webkit-scrollbar-thumb:hover{background:#94A3B8;}
body{font-feature-settings:"palt";letter-spacing:0.02em;}
.symptom-card{min-height:120px;}
@media (max-width:640px){
.symptom-card{min-height:110px;}
.factor-tag{font-size:0.7rem;padding:0.15rem 0.3rem;}
#symptoms-container{gap:2px;}
.btn-hover{transform:scale(1.02);}
.result-summary{font-size:0.9rem;}
.info-grid{grid-template-columns:repeat(2,1fr);gap:0.5rem;}
}
.info-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:0.75rem;}
.info-item{display:flex;justify-content:space-between;}
.severity-note{font-size:0.65rem;color:#94A3B8;margin-top:2px;}
</style>
</head>
<body class="bg-lightBg min-h-screen flex flex-col p-2 md:p-4">
<div class="max-w-5xl w-full bg-cardBg rounded-2xl shadow-elevation-2 overflow-hidden fade-in self-center">
<div class="bg-gradient-to-r from-primary to-[#006658] p-4 md:p-6 text-white text-center relative overflow-hidden">
<div class="absolute top-0 left-0 w-32 h-32 bg-white/5 rounded-full -translate-x-1/2 -translate-y-1/2"></div>
<div class="absolute bottom-0 right-0 w-48 h-48 bg-white/5 rounded-full translate-x-1/3 translate-y-1/3"></div>
<div class="relative z-10">
<div class="inline-flex items-center justify-center w-14 h-14 bg-white/10 backdrop-blur-sm rounded-full mb-3 pulse-subtle">
<i class="fa fa-heartbeat text-2xl text-accent"></i>
</div>
<h1 class="text-xl md:text-2xl font-bold mb-1 tracking-wide">ğŸ§¬ å½¥å½¬ è‡ªæª¢è¡¨ç³»çµ±</h1>
<p class="text-white/90 text-sm md:text-base font-light">å°ˆæ¥­å¥åº·è©•ä¼° Â· ç²¾å‡†å°æ‡‰ä¸ƒå¤§å¥åº·è¦ç´ </p>
</div>
</div>
<div class="p-3 md:p-5">
<div id="status" class="flex items-center justify-center py-6 text-textPrimary text-center">
<div class="text-center">
<div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary mb-3"></div>
<p id="status-text" class="text-base">æ­£åœ¨åˆå§‹åŒ–ç³»çµ±ï¼Œè«‹ç¨å€™...</p>
</div>
</div>
<div id="error-message" class="hidden bg-red-50 border border-red-100 text-red-700 px-4 py-3 rounded-xl mb-4 shadow-sm">
<div class="flex items-start">
<i class="fa fa-exclamation-circle text-red-500 mt-1 mr-2 text-lg"></i>
<div id="error-content"></div>
</div>
</div>
<div id="result-card" class="hidden bg-gradient-to-r from-secondary to-[#F0FAF8] border border-primary/15 rounded-2xl p-4 mb-4 text-center slide-up relative overflow-hidden">
<div class="absolute top-0 right-0 w-24 h-24 bg-primary/5 rounded-full translate-x-1/2 -translate-y-1/2"></div>
<div class="relative z-10">
<div id="result-main" class="text-lg md:text-xl font-bold mb-2 text-textPrimary"></div>
<div id="result-details" class="text-sm text-textSecondary space-y-1 md:space-y-1.5"></div>
<div class="w-20 h-0.5 bg-primary/20 mx-auto my-2"></div>
<p class="text-xs text-textSecondary/80"><i class="fa fa-info-circle text-primary mr-1"></i>è«‹æ ¹æ“šè‡ªèº«ç‹€æ³å¦‚å¯¦å¡«å¯«ï¼Œç³»çµ±å°‡ç‚ºæ‚¨æä¾›å°ˆæ¥­åƒè€ƒ</p>
</div>
</div>
<div id="user-info-section" class="hidden scale-in bg-neutral rounded-2xl p-3 md:p-4 mb-4 shadow-elevation-1">
<div class="text-center mb-3">
<h2 class="text-lg md:text-xl font-bold text-textPrimary mb-1"><span class="gradient-text bg-gradient-to-r from-primary to-[#006658]">ç”¨æˆ¶åŸºæœ¬è³‡è¨Š</span></h2>
<p class="text-textSecondary max-w-2xl mx-auto text-xs">è«‹æ ¹æ“šå¯¦éš›æƒ…æ³å¡«å¯«ï¼Œå¹«åŠ©ç³»çµ±ç²¾ç¢ºè©•ä¼°</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-3">
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">å§“å <span class="text-red-500">*</span></label>
<input type="text" id="user-name" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å" required>
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">å¹´é½¡ <span class="text-red-500">*</span></label>
<input type="number" id="user-age" min="0" max="120" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="è«‹è¼¸å…¥å¹´é½¡" required>
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">æ€§åˆ¥ <span class="text-red-500">*</span></label>
<select id="user-gender" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" required>
<option value="">è«‹é¸æ“‡æ€§åˆ¥</option>
<option value="male">ç”·</option>
<option value="female">å¥³</option>
</select>
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">èº«é«˜ (cm)</label>
<input type="number" id="user-height" min="50" max="250" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="é¸å¡«">
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">é«”é‡ (kg)</label>
<input type="number" id="user-weight" min="10" max="200" step="0.1" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="é¸å¡«">
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">è¡€å£“ (mmHg)</label>
<input type="text" id="user-bp" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="é¸å¡«ï¼Œä¾‹ï¼š120æ”¶ç¸®å£“/80èˆ’å¼µå£“">
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">è¡€ç³–(HbA1c)</label>
<input type="number" id="user-glucose" min="3" max="15" step="0.1" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="ç³–åŒ–è¡€è‰²ç´ ">
</div>
<div class="space-y-1">
<label class="block text-xs font-medium text-textPrimary">è·æ¥­</label>
<input type="text" id="user-job" class="w-full border border-gray-200 rounded-lg px-2 py-1.5 text-sm input-focus bg-white" placeholder="é¸å¡«">
</div>
</div>
<div class="text-center">
<button id="next-to-checklist" class="bg-gradient-to-r from-primary to-[#006658] hover:from-[#007A69] hover:to-[#00594D] text-white font-bold py-2 px-5 rounded-xl shadow-elevation-2 transition btn-hover transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
<i class="fa fa-arrow-right mr-1.5"></i>ç¹¼çºŒå¡«å¯«è‡ªæª¢è¡¨
</button>
</div>
</div>
<div id="checklist-section" class="hidden scale-in">
<div class="mb-3 text-center">
<h2 class="text-lg md:text-xl font-bold text-textPrimary mb-1"><span class="gradient-text bg-gradient-to-r from-primary to-[#006658]">è‡ªæª¢è¡¨å¡«å¯«å€åŸŸ</span></h2>
<p class="text-textSecondary max-w-2xl mx-auto mb-2 text-xs">è«‹å‹¾é¸å°æ‡‰ç—‡ç‹€ä¸¦å¡«å¯«ç›¸é—œè³‡è¨Š</p>
<div class="mt-2 flex flex-wrap justify-center gap-1.5 text-xs">
<span class="bg-blue-50 text-blue-700 factor-tag">æ°£è¡€</span>
<span class="bg-green-50 text-green-700 factor-tag">å¾ªç’°</span>
<span class="bg-yellow-50 text-yellow-700 factor-tag">æ¯’ç´ </span>
<span class="bg-orange-50 text-orange-700 factor-tag">è¡€è„‚</span>
<span class="bg-purple-50 text-purple-700 factor-tag">å¯’æ¿•</span>
<span class="bg-pink-50 text-pink-700 factor-tag">å…ç–«</span>
<span class="bg-indigo-50 text-indigo-700 factor-tag">æƒ…ç·’</span>
</div>
</div>
<div class="bg-neutral rounded-2xl p-2 mb-3 shadow-elevation-1">
<div class="flex flex-wrap gap-1.5 mb-2">
<button id="filter-all" class="bg-primary text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-[#007A69] transition btn-hover shadow-elevation-1">
<i class="fa fa-th-list mr-1"></i>é¡¯ç¤ºå…¨éƒ¨
</button>
<button data-factor="æ°£è¡€" class="bg-blue-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-blue-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>æ°£è¡€
</button>
<button data-factor="å¾ªç’°" class="bg-green-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-green-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>å¾ªç’°
</button>
<button data-factor="æ¯’ç´ " class="bg-yellow-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-yellow-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>æ¯’ç´ 
</button>
<button data-factor="è¡€è„‚" class="bg-orange-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-orange-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>è¡€è„‚
</button>
<button data-factor="å¯’æ¿•" class="bg-purple-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-purple-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>å¯’æ¿•
</button>
<button data-factor="å…ç–«" class="bg-pink-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-pink-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>å…ç–«
</button>
<button data-factor="æƒ…ç·’" class="bg-indigo-600 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-indigo-700 transition btn-hover shadow-elevation-1">
<i class="fa fa-tag mr-1"></i>æƒ…ç·’
</button>
</div>
<div class="flex flex-wrap items-center justify-between gap-2">
<button id="filter-selected" class="bg-gray-700 text-white px-2.5 py-1 rounded-lg text-xs font-medium hover:bg-gray-800 transition btn-hover shadow-elevation-1">
<i class="fa fa-filter mr-1"></i>åªçœ‹å·²é¸
</button>
<div class="text-textPrimary text-sm font-medium">
å·²å‹¾é¸: <span id="selected-count" class="font-bold text-primary text-base">0</span>/95 å€‹ç—‡ç‹€
</div>
</div>
</div>
<div id="symptoms-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2 mb-4"></div>
<div class="text-center mt-4 mb-2">
<button id="back-to-info" class="bg-gray-200 hover:bg-gray-300 text-textPrimary font-bold py-1.5 px-4 rounded-xl shadow-elevation-1 transition btn-hover mr-2">
<i class="fa fa-arrow-left mr-1.5"></i>è¿”å›ä¿®æ”¹è³‡è¨Š
</button>
<button id="submit-checklist" class="bg-gradient-to-r from-primary to-[#006658] hover:from-[#007A69] hover:to-[#00594D] text-white font-bold py-2 px-5 rounded-xl shadow-elevation-2 transition btn-hover transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary/50">
<i class="fa fa-paper-plane mr-1.5"></i>æäº¤è‡ªæª¢è¡¨
</button>
<p class="text-xs text-textSecondary/70 mt-2">æäº¤å¾Œå°‡ç”Ÿæˆå°ˆæ¥­åƒè€ƒå ±å‘Šï¼Œè«‹ç¢ºä¿ä¿¡æ¯çœŸå¯¦æœ‰æ•ˆ</p>
</div>
</div>
</div>
</div>
<div id="success-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden fade-in p-2">
<div class="bg-cardBg rounded-2xl p-4 max-w-md w-full mx-2 text-center shadow-elevation-3 transform transition-all hover:shadow-elevation-hover">
<div id="report-summary" class="border border-gray-100 rounded-xl p-3 mb-3 bg-neutral/50 text-left result-summary">
<h4 class="text-sm font-medium text-textPrimary mb-2 flex items-center"><i class="fa fa-file-text-o text-primary mr-1.5"></i>å½¥å½¬ è‡ªæª¢è¡¨ç³»çµ±</h4>
<div id="summary-content" class="text-xs space-y-1.5"></div>
</div>
</div>
</div>

<script>
const LIFF_ID="2008578880-NznKeG2a";
const GAS_URL="https://script.google.com/macros/s/AKfycbykBtM2_PM7IZ-ZUU4tgTqVa1xGhVQFaZ523FXc4ivdLz_GZ09sdmL6s5zk7SdloFuG/exec";
const JSONP_TIMEOUT=12000;
const PERMANENT_EXPIRY_DATE="9999/12/31";
const fStyles={
  æ°£è¡€:{className:'bg-slate-700/30 text-slate-400',label:'æ°£è¡€'},
  å¾ªç’°:{className:'bg-emerald-700/30 text-emerald-400',label:'å¾ªç’°'},
  æ¯’ç´ :{className:'bg-amber-700/30 text-amber-400',label:'æ¯’ç´ '},
  è¡€è„‚:{className:'bg-orange-800/30 text-orange-400',label:'è¡€è„‚'},
  å¯’æ¿•:{className:'bg-violet-700/30 text-violet-400',label:'å¯’æ¿•'},
  å…ç–«:{className:'bg-pink-800/30 text-pink-400',label:'å…ç–«'},
  æƒ…ç·’:{className:'bg-indigo-800/30 text-indigo-400',label:'æƒ…ç·’'}
};
const durOpts=[{value:'',label:'è«‹é¸æ“‡æ™‚é–“'},{value:'1w',label:'1å‘¨å…§'},{value:'1-3m',label:'1-3å€‹æœˆ'},{value:'3-6m',label:'3-6å€‹æœˆ'},{value:'6m-1y',label:'6å€‹æœˆ-1å¹´'},{value:'1-2y',label:'1-2å¹´'},{value:'2-5y',label:'2-5å¹´'},{value:'5y+',label:'5å¹´ä»¥ä¸Š'}];
const sevOpts=[{value:'',label:'è«‹é¸æ“‡è¼•é‡'},{value:'mild',label:'è¼•åº¦ï¼ˆä¸å½±éŸ¿ç”Ÿæ´»ï¼‰'},{value:'moderate',label:'ä¸­åº¦ï¼ˆå¶çˆ¾å½±éŸ¿ï¼‰'},{value:'severe',label:'é‡åº¦ï¼ˆæ˜é¡¯å½±éŸ¿ï¼‰'}];
const fullSymptomData=[
{seq:1,symptom:"è¨˜æ†¶åŠ›ä¸‹é™",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:2,symptom:"æ€ç¶­æ–·é›»",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:3,symptom:"åæ‡‰é²éˆ",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:4,symptom:"å—œç¡",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:5,symptom:"å¤šå¤¢",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:6,symptom:"é ­æšˆ",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:7,symptom:"é ­ç–¼",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:8,symptom:"é ­éº»",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:9,symptom:"æšˆè»Š",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:10,symptom:"å¤±çœ ",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:11,symptom:"é ­é¢æ²¹è†©",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:12,symptom:"è„«ç™¼",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:13,symptom:"é ­é«®ç¨€å°‘",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:14,symptom:"æ˜“æ‰“å“ˆæ¬ ",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:15,symptom:"å¸¸å˜†æ°£",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:16,symptom:"çœ¼ä¹¾æ¾€",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:17,symptom:"çœ¼ç™¢",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:18,symptom:"çœ¼ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:19,symptom:"è¦–åŠ›æ¨¡ç³Š",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:20,symptom:"çœ¼å±å¤š",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:21,symptom:"çœ¼æ€•å…‰æµæ·š",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:22,symptom:"éº¥ç²’è…«",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:23,symptom:"è½åŠ›ä¸‹é™",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:24,symptom:"è€³ç™¢",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:25,symptom:"è€³é³´",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:26,symptom:"è€³ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:27,symptom:"è€³å±å¤š",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:28,symptom:"è€³å…§æ½®æ¿•",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:29,symptom:"æ‰“é¼¾",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:30,symptom:"é¼»å¡",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:31,symptom:"æ„›æ‰“å™´åš",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:32,symptom:"å¸¸æµé¼»æ¶•",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:33,symptom:"é¼»ç‚",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:34,symptom:"æ„Ÿå†’æ™‚é–“é•·",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:35,symptom:"å—“å­ä¹¾",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:36,symptom:"å–‰åš¨ç™¢",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:37,symptom:"å–‰åš¨ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:38,symptom:"å’³å—½",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:39,symptom:"ç—°å¤š",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:40,symptom:"å‘¼å¸å›°é›£",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:41,symptom:"å£è‹¦",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:42,symptom:"å£ä¹¾",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:43,symptom:"å£è‡­",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:44,symptom:"å£è…”æ½°ç˜",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:45,symptom:"èˆŒæ½°ç˜",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:46,symptom:"å˜´å”‡éº»",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:47,symptom:"èˆŒç¡¬",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:48,symptom:"èƒ¸æ‚¶æ°£çŸ­",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:49,symptom:"å¿ƒæ…Œå¿ƒæ‚¸",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:50,symptom:"å¿ƒçµç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:51,symptom:"æŒ‡ç”²å‡¹é™·",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:52,symptom:"åŠæœˆç—•å°‘",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:53,symptom:"æ‰‹è…³è„«çš®",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:54,symptom:"æ‰‹è…³å‡ºæ±—",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:55,symptom:"æ‰‹è…³æ¶¼",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:56,symptom:"æ‰‹è…³ç†±",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:57,symptom:"æ‰‹è¶³éº»æœ¨",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:58,symptom:"å››è‚¢ä¹åŠ›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:59,symptom:"éœè„ˆæ›²å¼µ",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:60,symptom:"é—œç¯€ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:61,symptom:"è‚©é…¸ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:62,symptom:"é ¸æ¤ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:63,symptom:"è…°é…¸ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:64,symptom:"å°¿æ¸¾æ¿",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:65,symptom:"å°¿å¤šæ²«",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:66,symptom:"å°¿æœ‰æ€ªå‘³",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:67,symptom:"å¤œå°¿å¤š",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:""},
{seq:68,symptom:"ä¾¿ç§˜",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:69,symptom:"å¤§ä¾¿ä¸æˆå½¢",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:70,symptom:"ä¾¿æºä¸æ·¨",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:71,symptom:"ç¶“æœŸé ­ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:72,symptom:"æœˆç¶“é‡å°‘",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:73,symptom:"ç¶“æœŸæ™‚é•·",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:74,symptom:"ç¶“æœŸæ¨å¾Œ",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:75,symptom:"æœˆç¶“æœ‰è¡€å¡Š",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:76,symptom:"ä¹³è…ºå¢ç”Ÿ",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:77,symptom:"ç¶“æœŸè…°ç—›",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:78,symptom:"ç¶“æœŸæå‰",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:79,symptom:"æœˆç¶“é‡å¤š",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:80,symptom:"ä¸æ„›èªªè©±",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:81,symptom:"æƒ¡å¿ƒ",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:82,symptom:"èƒƒè„¹",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:83,symptom:"èƒƒé…¸",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:84,symptom:"èƒƒç—›",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:85,symptom:"æ¶ˆåŒ–ä¸è‰¯",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:86,symptom:"è‚¥èƒ–",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"",æƒ…ç·’:"â—‹"},
{seq:87,symptom:"çš®è†šç™¢",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:88,symptom:"æ¿•ç–¹",æ°£è¡€:"â—‹",å¾ªç’°:"â—‹",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:89,symptom:"å„ç¨®éæ•",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:90,symptom:"ç—¤ç˜¡",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:91,symptom:"è„‚è‚ªç˜¤",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"â—‹",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:92,symptom:"èº«é«”ç•°å‘³",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"â—‹",å¯’æ¿•:"",å…ç–«:"",æƒ…ç·’:""},
{seq:93,symptom:"æ·‹å·´è…«å¤§",æ°£è¡€:"",å¾ªç’°:"â—‹",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"â—‹",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"},
{seq:94,symptom:"é»‘ç—£è®Šå¤§è®Šå¤š",æ°£è¡€:"",å¾ªç’°:"",æ¯’ç´ :"â—‹",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:""},
{seq:95,symptom:"å½¢é«”æ¶ˆç˜¦",æ°£è¡€:"â—‹",å¾ªç’°:"",æ¯’ç´ :"",è¡€è„‚:"",å¯’æ¿•:"",å…ç–«:"â—‹",æƒ…ç·’:"â—‹"}];
const setStatus=text=>{const e=document.getElementById('status-text');e&&(e.textContent=text);};
const showError=msg=>{
document.getElementById('status').classList.add('hidden');
document.getElementById('result-card').classList.add('hidden');
document.getElementById('user-info-section').classList.add('hidden');
document.getElementById('checklist-section').classList.add('hidden');
const e=document.getElementById('error-message'),c=document.getElementById('error-content');
e&&c&&(c.innerHTML=`<p class="font-medium">${msg}</p><div class="mt-3 flex justify-center"><button onclick="window.location.reload()" class="text-primary hover:text-[#007A69] font-medium flex items-center gap-1"><i class="fa fa-refresh"></i> é‡æ–°å˜—è©¦</button></div>`,e.classList.remove('hidden'));
};
const calculateRemainingDaysByDate=expiryDateStr=>{
try{
if(expiryDateStr===PERMANENT_EXPIRY_DATE)return{displayDate:"æ°¸ä¹…æœ‰æ•ˆ",remainingDays:"æ°¸ä¹…æœ‰æ•ˆ"};
const r=/^\d{4}[-\/]\d{2}[-\/]\d{2}$/;
if(!r.test(expiryDateStr))return{displayDate:"æ ¼å¼éŒ¯èª¤",remainingDays:"æ ¼å¼éŒ¯èª¤"};
const d=expiryDateStr.replace(/-/g,'/').split('/').map(Number),ed=new Date(Date.UTC(d[0],d[1]-1,d[2])),td=new Date(),tutc=new Date(Date.UTC(td.getFullYear(),td.getMonth(),td.getDate()));
if(isNaN(ed.getTime()))return{displayDate:"æ—¥æœŸç„¡æ•ˆ",remainingDays:"æ—¥æœŸç„¡æ•ˆ"};
const tdiff=ed-tutc,rd=Math.ceil(tdiff/(1000*3600*24)),fd=`${d[0]}/${String(d[1]).padStart(2,'0')}/${String(d[2]).padStart(2,'0')}`;
let rt;
if(rd<0)rt="<span class='text-red-500 font-medium'>å·²éæœŸ</span>";
else if(rd===0)rt="<span class='text-orange-500 font-medium'>æœ€å¾Œ1å¤©</span>";
else if(rd<=30)rt=`<span class='text-orange-500 font-medium'>${rd} å¤©</span>`;
else rt=`${rd} å¤©`;
return{displayDate:fd,remainingDays:rt};
}catch(e){console.error("è¨ˆç®—å‰©é¤˜å¤©æ•¸å¤±æ•—ï¼š",e,expiryDateStr);return{displayDate:"è¨ˆç®—éŒ¯èª¤",remainingDays:"è¨ˆç®—éŒ¯èª¤"}};
};
const createSubmitLoadingTip=()=>{
if(document.getElementById('submit-loading-tip'))return;
const tip=document.createElement('div');
tip.id='submit-loading-tip';
tip.style.cssText=`position:fixed;bottom:90px;right:20px;z-index:9998;background:rgba(0,0,0,0.7);color:white;padding:10px 16px;border-radius:8px;display:flex;align-items:center;gap:8px;opacity:0;transition:opacity 0.3s ease;`;
tip.innerHTML='<i class="fa fa-spinner fa-spin"></i><span>æäº¤ä¸­ï¼Œè«‹ç¨å€™...</span>';
document.body.appendChild(tip);
};
const showSubmitLoading=()=>{
const tip=document.getElementById('submit-loading-tip');
tip&&(tip.style.opacity='1');
};
const hideSubmitLoading=()=>{
const tip=document.getElementById('submit-loading-tip');
tip&&(tip.style.opacity='0');
};
function renderSymptomCards(){
try{
const c=document.getElementById('symptoms-container');
if(!c)return false;
c.innerHTML='';
fullSymptomData.forEach((s,i)=>{
const rf=[],doh=durOpts.map(o=>`<option value="${o.value}">${o.label}</option>`).join(''),soh=sevOpts.map(o=>`<option value="${o.value}">${o.label}</option>`).join('');
Object.entries(fStyles).forEach(([k,st])=>s[k]==="â—‹"&&rf.push(`<span class="factor-tag ${st.className} px-2 py-1 text-sm rounded">${st.label}</span>`));
const cd=document.createElement('div');
cd.className='symptom-card bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-xl p-3 shadow-sm card-hover';
cd.dataset.seq=s.seq;
cd.dataset.factors=Object.entries(fStyles).filter(([k])=>s[k]==="â—‹").map(([k])=>k).join(',');
cd.style.opacity='0';
cd.style.transform='translateY(20px)';
cd.style.transition='all 0.3s cubic-bezier(0.34,1.56,0.64,1)';
cd.style.transitionDelay=`${i*15}ms`;
cd.innerHTML=`
<div class="flex items-start gap-3">
<div class="flex-shrink-0 mt-1"><input type="checkbox" id="symptom-${s.seq}" class="symptom-checkbox h-5 w-5 text-primary rounded border-slate-600 input-focus" data-seq="${s.seq}"></div>
<div class="flex-1">
<div class="flex justify-between items-start mb-2"><label for="symptom-${s.seq}" class="text-slate-200 font-medium cursor-pointer text-base"><span class="text-primary mr-1 font-semibold">[${s.seq}]</span>${s.symptom}</label></div>
<div class="flex flex-wrap gap-2 mb-2">${rf.length>0?rf.join(''):'<span class="factor-tag bg-slate-700 text-slate-400 px-2 py-1 text-sm rounded">ç„¡ç›¸é—œè¦ç´ </span>'}</div>
<div class="symptom-details hidden mt-3 pt-3 border-t border-slate-700">
<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
<div><label class="block text-sm text-slate-400 mb-1.5">æ™‚é–“é•·çŸ­</label><select class="duration-select w-full border border-slate-700 rounded-lg px-3 py-2 text-sm input-focus bg-slate-800 text-slate-200">${doh}</select></div>
<div><label class="block text-sm text-slate-400 mb-1.5">ç—‡ç‹€è¼•é‡</label><select class="severity-select w-full border border-slate-700 rounded-lg px-3 py-2 text-sm input-focus bg-slate-800 text-slate-200">${soh}</select></div>
</div></div></div></div>`;
c.appendChild(cd);
setTimeout(()=>{cd.style.opacity='1';cd.style.transform='translateY(0)';},50);
});
bindCheckboxEvents();
return true;
}catch(e){console.error("æ¸²æŸ“ç—‡ç‹€å¡ç‰‡å‡ºéŒ¯ï¼š",e);return false;}
}
function bindCheckboxEvents(){
document.querySelectorAll('.symptom-checkbox').forEach(cb=>{
cb.addEventListener('change',function(){
const cd=this.closest('.symptom-card'),dt=cd.querySelector('.symptom-details');
this.checked?(dt.classList.remove('hidden'),cd.classList.add('border-primary/30','bg-slate-750','shadow-md')):(dt.classList.add('hidden'),cd.classList.remove('border-primary/30','bg-slate-750','shadow-md'),cd.querySelector('.duration-select').value='',cd.querySelector('.severity-select').value='');
updateSelectedCount();
});
});
}
function updateSelectedCount(){
const cnt=document.querySelectorAll('.symptom-checkbox:checked').length;
document.getElementById('selected-count').textContent=cnt;
return cnt;
}
function initFilterButtons(){
const fb=document.querySelectorAll('[data-factor], #filter-all');
let cf='all',sos=false;
fb.forEach(b=>{
b.addEventListener('click',function(){
fb.forEach(bt=>bt.classList.remove('shadow-md','scale-105'));
this.classList.add('shadow-md','scale-105');
cf=this.id==='filter-all'?'all':this.dataset.factor;
applyFilters();
});
});
document.getElementById('filter-selected').addEventListener('click',function(){
sos=!sos;
if(sos){this.classList.remove('bg-slate-700','hover:bg-slate-600');this.classList.add('bg-red-900/50','hover:bg-red-800/50','shadow-md');this.innerHTML='<i class="fa fa-filter mr-1"></i>é¡¯ç¤ºå…¨éƒ¨å·²å‹¾é¸';}
else{this.classList.remove('bg-red-900/50','hover:bg-red-800/50','shadow-md');this.classList.add('bg-slate-700','hover:bg-slate-600');this.innerHTML='<i class="fa fa-filter mr-1"></i>åªçœ‹å·²é¸';}
applyFilters();
});
function applyFilters(){
document.querySelectorAll('.symptom-card').forEach(cd=>{
let ss=true;
if(cf!=='all'){const cfs=cd.dataset.factors.split(',');ss=cfs.includes(cf);}
if(sos&&ss)ss=cd.querySelector('.symptom-checkbox').checked;
if(ss){cd.style.display='block';setTimeout(()=>{cd.style.opacity='1';cd.style.transform='translateY(0)';},10);}
else{cd.style.opacity='0';cd.style.transform='translateY(10px)';setTimeout(()=>{cd.style.display='none';},300);}
});
}
}
function organizeReportData(submitData){
const {userBasicInfo,selectedSymptoms,displayName,submitTime}=submitData,fs={æ°£è¡€:[],å¾ªç’°:[],æ¯’ç´ :[],è¡€è„‚:[],å¯’æ¿•:[],å…ç–«:[],æƒ…ç·’:[]};
selectedSymptoms.forEach(s=>{
const os=fullSymptomData.find(ss=>ss.seq===s.seq);
os&&Object.keys(fs).forEach(f=>os[f]==="â—‹"&&fs[f].push({name:s.symptom,duration:s.durationText,severity:s.severityText}));
});
const factorTotalCounts={};
Object.keys(fs).forEach(factor=>{
factorTotalCounts[factor]=fullSymptomData.filter(sym=>sym[factor]==="â—‹").length;
});
const factorRatio={};
Object.keys(fs).forEach(factor=>{
const total=factorTotalCounts[factor];
const count=fs[factor].length;
const ratio=total>0?((count/total)*100).toFixed(1):0;
factorRatio[factor]={count,total,ratio:`${ratio}%`,ratioVal:parseFloat(ratio)};
});
const factorPercentages=Object.entries(fs).map(([key,list])=>{
const {count,ratio,ratioVal}=factorRatio[key];
return{
name:fStyles[key].label,count,total:factorTotalCounts[key],
percentage:ratio,percentageValue:ratioVal,key
};
}).filter(item=>item.count>0).sort((a,b)=>b.percentageValue-a.percentageValue);
const topPercentageFactors=factorPercentages.slice(0,2);
const ffs=Object.fromEntries(Object.entries(fs).filter(([_,f])=>f.length>0)),fui={
å§“å:userBasicInfo.name||'æœªå¡«å¯«',å¹´é½¡:userBasicInfo.age?`${userBasicInfo.age}æ­²`:'æœªå¡«å¯«',
æ€§åˆ¥:userBasicInfo.gender==='male'?'ç”·':userBasicInfo.gender==='female'?'å¥³':'æœªå¡«å¯«',
èº«é«˜:userBasicInfo.height?`${userBasicInfo.height}cm`:'æœªå¡«å¯«',é«”é‡:userBasicInfo.weight?`${userBasicInfo.weight}kg`:'æœªå¡«å¯«',
è¡€å£“:userBasicInfo.bp||'æœªå¡«å¯«',è¡€ç³–:userBasicInfo.glucose?`${userBasicInfo.glucose}%`:'æœªå¡«å¯«',
è·æ¥­:userBasicInfo.job||'æœªå¡«å¯«',æäº¤æ™‚é–“:new Date(submitTime).toLocaleString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'})
};
const totalSymptomCount=fullSymptomData.length;
const allSelectedSymptoms=new Set();
Object.values(ffs).forEach(factorSymptoms=>{
factorSymptoms.forEach(symptom=>allSelectedSymptoms.add(symptom.name));
});
const selectedTotal=allSelectedSymptoms.size;
let factorText='';
Object.entries(fs).forEach(([key,list])=>{
if(list.length>0){
factorText+=`\n\nğŸ¯ã€${fStyles[key].label}ã€‘(${list.length}é …/ç¸½${factorTotalCounts[key]}é … | ä½”æ¯”${factorRatio[key].ratio})`;
list.forEach((item,idx)=>{
factorText+=`\n  ${idx+1}. ğŸ“Œ${item.name}`;
factorText+=`\n     â±ï¸ æŒçºŒæ™‚é–“ï¼š${item.duration}`;
factorText+=`\n     âš ï¸ ç—‡ç‹€ç¨‹åº¦ï¼š${item.severity}`;
});
}
});
let st=`ğŸ“‹ å½¥å½¬è‡ªæª¢è¡¨ç³»çµ± 
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ åŸºæœ¬è³‡è¨Š
  â”œâ”€â”€ å§“åï¼š${fui.å§“å}
  â”œâ”€â”€ å¹´é½¡ï¼š${fui.å¹´é½¡}
  â”œâ”€â”€ æ€§åˆ¥ï¼š${fui.æ€§åˆ¥}
  â”œâ”€â”€ èº«é«˜ï¼š${fui.èº«é«˜}
  â”œâ”€â”€ é«”é‡ï¼š${fui.é«”é‡}
  â”œâ”€â”€ è¡€å£“ï¼š${fui.è¡€å£“}
  â”œâ”€â”€ è¡€ç³–ï¼š${fui.è¡€ç³–}
  â”œâ”€â”€ è·æ¥­ï¼š${fui.è·æ¥­}
  â””â”€â”€ æäº¤æ™‚é–“ï¼š${fui.æäº¤æ™‚é–“}

ğŸ“Š æ•´é«”çµ±è¨ˆ
  â”œâ”€â”€ ç¸½é¸å–ç—‡ç‹€ï¼š${selectedTotal} é … (ç³»çµ±å…±${totalSymptomCount}ç¨®ç—‡ç‹€)
  â””â”€â”€ æœ€é«˜ä½”æ¯”è¦ç´ ï¼š${topPercentageFactors.length>0 
? (topPercentageFactors.length===1 
    ? `${topPercentageFactors[0].name} (${topPercentageFactors[0].percentage})` 
    : `${topPercentageFactors[0].name} (${topPercentageFactors[0].percentage})ã€${topPercentageFactors[1].name} (${topPercentageFactors[1].percentage})`) 
: 'ç„¡'}

ğŸ©º ğŸŒŸä¸ƒå¤§å¥åº·è¦ç´ è©•ä¼°ğŸŒŸ
${factorText ? factorText : '  â””â”€â”€ æš«ç„¡ç›¸é—œç—‡ç‹€è¨˜éŒ„'}

ğŸ’¡ å¥åº·å»ºè­°
  â””â”€â”€ æ ¹æ“šè‡ªæª¢çµæœé—œæ³¨å°æ‡‰å¥åº·å•é¡Œï¼Œå¿…è¦æ™‚è«®è©¢å°ˆæ¥­é†«å¸«
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”– ä¾†æºï¼šå½¥å½¬è‡ªæª¢è¡¨ç³»çµ±`;
return{formattedUserInfo:fui,factorSymptoms:ffs,summaryText:st,totalSymptomCount,selectedTotal,topFactors:topPercentageFactors,factorRatio};
}
function createFloatingButtons(){
if(document.getElementById('floating-buttons'))return;
const floatContainer=document.createElement('div');
floatContainer.id='floating-buttons';
floatContainer.style.cssText=`position: fixed;bottom: 20px;right: 20px;z-index: 9999;display: flex;flex-direction: column;gap: 10px;opacity: 0;transition: opacity 0.3s ease;`;
const shareBtn=document.createElement('button');
shareBtn.id='floating-share-btn';
shareBtn.className='custom-styled';
shareBtn.style.cssText=`width: 56px;height: 56px;border-radius: 50%;background-color: #00A86B;color: white;border: none;box-shadow: 0 4px 12px rgba(0, 168, 107, 0.3);display: flex;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s ease;`;
shareBtn.innerHTML='<i class="fa fa-share-alt mr-1"></i>åˆ†äº«';
shareBtn.title='åˆ†äº«å ±å‘Š';
const closeBtn=document.createElement('button');
closeBtn.id='floating-close-btn';
closeBtn.className='custom-styled';
closeBtn.style.cssText=`width: 56px;height: 56px;border-radius: 50%;background-color: #718096;color: white;border: none;box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);display: none;align-items: center;justify-content: center;cursor: pointer;transition: all 0.2s ease;opacity: 0;`;
closeBtn.innerHTML='<i class="fa fa-times mr-1"></i>é—œé–‰';
closeBtn.title='é—œé–‰é é¢';
shareBtn.addEventListener('mouseenter',()=>{
shareBtn.style.transform='scale(1.08)';
shareBtn.style.boxShadow='0 6px 16px rgba(0, 168, 107, 0.4)';
});
shareBtn.addEventListener('mouseleave',()=>{
shareBtn.style.transform='scale(1)';
shareBtn.style.boxShadow='0 4px 12px rgba(0, 168, 107, 0.3)';
});
closeBtn.addEventListener('mouseenter',()=>{
closeBtn.style.transform='scale(1.08)';
closeBtn.style.boxShadow='0 6px 16px rgba(0, 0, 0, 0.3)';
});
closeBtn.addEventListener('mouseleave',()=>{
closeBtn.style.transform='scale(1)';
closeBtn.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.2)';
});
shareBtn.addEventListener('click',handleFloatingShareClick);
closeBtn.addEventListener('click',async()=>{
try{
if(window.liff){
if(!liff.isLoggedIn())await liff.login();
liff.closeWindow();
}else{
window.close();
}
}catch(error){
console.error('é—œé–‰çª—å£å¤±æ•—:',error);
window.close();
}
});
floatContainer.appendChild(shareBtn);
floatContainer.appendChild(closeBtn);
document.body.appendChild(floatContainer);
setTimeout(()=>{
floatContainer.style.opacity='1';
},300);
}
function initControlButtons(){
createSubmitLoadingTip();
const styleButtons=()=>{
const buttons=document.querySelectorAll('button');
buttons.forEach(btn=>{
if(!btn.classList.contains('custom-styled')){
btn.classList.add('custom-styled','px-6','py-2.5','rounded-lg','font-medium','transition-all','duration-300','shadow-sm','hover:shadow-md','transform','hover:-translate-y-0.5','active:translate-y-0');
btn.classList.remove('px-8','py-3');
}
});
};
document.getElementById('next-to-checklist').addEventListener('click',function(){
const n=document.getElementById('user-name').value.trim(),a=document.getElementById('user-age').value.trim(),g=document.getElementById('user-gender').value;
if(!n){alert('è«‹è¼¸å…¥å§“å');document.getElementById('user-name').focus();return;}
if(!a||isNaN(a)||a<0||a>120){alert('è«‹è¼¸å…¥æœ‰æ•ˆå¹´é½¡');document.getElementById('user-age').focus();return;}
if(!g){alert('è«‹é¸æ“‡æ€§åˆ¥');document.getElementById('user-gender').focus();return;}
window.userBasicInfo={
name:n,age:parseInt(a),gender:g,
height:document.getElementById('user-height').value?parseInt(document.getElementById('user-height').value):null,
weight:document.getElementById('user-weight').value?parseFloat(document.getElementById('user-weight').value):null,
bp:document.getElementById('user-bp').value.trim()||null,
glucose:document.getElementById('user-glucose').value?parseFloat(document.getElementById('user-glucose').value):null,
job:document.getElementById('user-job').value.trim()||null
};
document.getElementById('user-info-section').classList.add('hidden');
document.getElementById('checklist-section').classList.remove('hidden');
renderSymptomCards();
initFilterButtons();
document.getElementById('checklist-section').scrollIntoView({behavior:'smooth'});
styleButtons();
});
document.getElementById('back-to-info').addEventListener('click',function(){
document.getElementById('checklist-section').classList.add('hidden');
document.getElementById('user-info-section').classList.remove('hidden');
if(window.userBasicInfo){
document.getElementById('user-name').value=window.userBasicInfo.name||'';
document.getElementById('user-age').value=window.userBasicInfo.age||'';
document.getElementById('user-gender').value=window.userBasicInfo.gender||'';
document.getElementById('user-height').value=window.userBasicInfo.height||'';
document.getElementById('user-weight').value=window.userBasicInfo.weight||'';
document.getElementById('user-bp').value=window.userBasicInfo.bp||'';
document.getElementById('user-glucose').value=window.userBasicInfo.glucose||'';
document.getElementById('user-job').value=window.userBasicInfo.job||'';
}
document.getElementById('user-info-section').scrollIntoView({behavior:'smooth'});
});
document.getElementById('submit-checklist').addEventListener('click',async function(){
const btn=this;
btn.disabled=true;
btn.innerHTML='<i class="fa fa-spinner fa-spin mr-1"></i> æäº¤ä¸­...';
showSubmitLoading();
const sc=updateSelectedCount();
if(sc===0){alert('è«‹è‡³å°‘å‹¾é¸ä¸€å€‹ç—‡ç‹€');btn.disabled=false;btn.innerHTML='æäº¤æª¢æŸ¥è¡¨';hideSubmitLoading();return;}
let iv=true,fic=null;
document.querySelectorAll('.symptom-checkbox:checked').forEach(cb=>{
const cd=cb.closest('.symptom-card'),d=cd.querySelector('.duration-select').value,s=cd.querySelector('.severity-select').value;
if(!d||!s){iv=false;fic=fic||cd;cd.classList.add('border-red-700');cd.style.transform='scale(1.03)';setTimeout(()=>{cd.classList.remove('border-red-700');cd.style.transform='';},1500);}
});
if(!iv){alert('éƒ¨åˆ†å·²é¸ç—‡ç‹€æœªå¡«å¯«å®Œæ•´è³‡è¨Šï¼Œè«‹æª¢æŸ¥å¾Œå†æäº¤');fic&&fic.scrollIntoView({behavior:'smooth',block:'center'});btn.disabled=false;btn.innerHTML='æäº¤æª¢æŸ¥è¡¨';hideSubmitLoading();return;}
const sd=await collectSubmitData();
submitChecklistData(sd,btn);
});
styleButtons();
}
async function handleFloatingShareClick(e){
e.stopPropagation();
const btn=e.target.closest('#floating-share-btn');
if(!window.reportData){
alert('å°šæœªç”Ÿæˆå¥åº·å ±å‘Šï¼Œç„¡æ³•åˆ†äº«');
return;
}
try{
const screenshotTarget=document.getElementById('screenshot-target');
if(!screenshotTarget){
alert('å ±å‘Šå€åŸŸåŠ è¼‰å¤±æ•—ï¼Œè«‹ç¨å€™å†è©¦');
return;
}
const floatContainer=document.getElementById('floating-buttons');
const floatStyle=floatContainer.style.opacity;
floatContainer.style.opacity='0';
const originalStyle={
width:screenshotTarget.style.width,
backgroundColor:screenshotTarget.style.backgroundColor,
padding:screenshotTarget.style.padding,
borderRadius:screenshotTarget.style.borderRadius,
boxShadow:screenshotTarget.style.boxShadow,
maxWidth:screenshotTarget.style.maxWidth,
textAlign:screenshotTarget.style.textAlign,
margin:screenshotTarget.style.margin,
height:screenshotTarget.style.height,
overflow:screenshotTarget.style.overflow
};
screenshotTarget.style.cssText=`width: 100vw !important;max-width: none !important;padding: 2rem !important;box-sizing: border-box !important;border-radius: 0 !important;box-shadow: none !important;margin: 0 auto !important;text-align: center !important;height: auto !important;overflow: visible !important;`;
btn.disabled=true;
btn.innerHTML='<i class="fa fa-spinner fa-spin"></i>';
if(!window.html2canvas){
alert('æ­£åœ¨åŠ è¼‰åˆ†äº«æ‰€éœ€çµ„ä»¶ï¼Œè«‹ç¨å€™...');
await new Promise((resolve,reject)=>{
const script=document.createElement('script');
script.src='https://html2canvas.hertzen.com/dist/html2canvas.min.js';
script.onload=resolve;
script.onerror=reject;
document.head.appendChild(script);
});
}
const canvas=await html2canvas(screenshotTarget,{
scale:3,useCORS:true,allowTaint:true,logging:false,dpi:300,
windowWidth:window.innerWidth,windowHeight:screenshotTarget.offsetHeight+100,scrollY:0,scrollX:0
});
Object.keys(originalStyle).forEach(key=>{
screenshotTarget.style[key]=originalStyle[key];
});
floatContainer.style.opacity=floatStyle;
let dataUrl=canvas.toDataURL('image/png',0.9);
const fileName=`ğŸ§¬ å½¥å½¬è‡ªæª¢è¡¨ç³»çµ±_${new Date().toLocaleDateString()}.png`;
const imgBlob=await(await fetch(dataUrl)).blob();
let file;
if(imgBlob.size>5*1024*1024){
alert('åœ–ç‰‡é«”ç©éå¤§ï¼Œè¼•å¾®å£“ç¸®ä¿æŒæ¸…æ™°...');
dataUrl=canvas.toDataURL('image/png',0.8);
const compressedBlob=await(await fetch(dataUrl)).blob();
file=new File([compressedBlob],fileName,{type:'image/png'});
}else{
file=new File([imgBlob],fileName,{type:'image/png'});
}
if(navigator.share&&typeof navigator.share==='function'){
try{
const shareData={
title:'ğŸ“‹ å½¥å½¬è‡ªæª¢è¡¨ç³»çµ± - å¥åº·è©•ä¼°å ±å‘Š',
files:[file],
text:window.reportData.summaryText
};
const canShare=navigator.canShare?await navigator.canShare(shareData):true;
if(canShare){
await navigator.share(shareData);
alert('âœ… åˆ†äº«æˆåŠŸï¼\nå ±å‘Šå·²ç™¼é€åˆ°LINEç¾¤çµ„/å¥½å‹');
const closeBtn=document.getElementById('floating-close-btn');
closeBtn.style.display='flex';
setTimeout(()=>{
closeBtn.style.opacity='1';
},200);
}
}catch(err){
console.error('LINEåˆ†äº«å¤±æ•—ï¼š',err);
if(err.name!=='AbortError'){
alert(`âŒ åˆ†äº«å¤±æ•—ï¼š${err.message||'æœªçŸ¥éŒ¯èª¤'}\nå·²è‡ªå‹•è¤‡è£½æ–‡å­—å ±å‘Šåˆ°å‰ªè²¼æ¿`);
await navigator.clipboard.writeText(window.reportData.summaryText);
}
}
}else{
await navigator.clipboard.writeText(window.reportData.summaryText);
alert('ğŸ“‹ æ–‡å­—å ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼Œè«‹æ‰‹å‹•æˆªåœ–åˆ†äº«');
}
}catch(err){
console.error('åˆ†äº«ç¸½é«”éŒ¯èª¤ï¼š',err);
try{
await navigator.clipboard.writeText(window.reportData.summaryText);
alert('âš ï¸ åˆ†äº«åŠŸèƒ½ç•°å¸¸ï¼Œå·²è¤‡è£½æ–‡å­—å ±å‘Šåˆ°å‰ªè²¼æ¿ï¼Œè«‹æ‰‹å‹•æˆªåœ–åˆ†äº«');
}catch(cbErr){
alert('âš ï¸ åˆ†äº«åŠŸèƒ½ç•°å¸¸ï¼Œè«‹æ‰‹å‹•æˆªåœ–ä¸¦è¤‡è£½ä»¥ä¸‹æ–‡å­—åˆ†äº«ï¼š\n\n'+window.reportData.summaryText);
}
}finally{
btn.disabled=false;
btn.innerHTML='<i class="fa fa-share-alt mr-1"></i>åˆ†äº«';
document.getElementById('floating-buttons').style.opacity='1';
}
}
async function collectSubmitData(){
const liffProfile=await liff.getProfile().catch(err=>{
console.error("ç²å–LINEç”¨æˆ¶ä¿¡æ¯å¤±æ•—ï¼š",err);
return{displayName:'LINEç”¨æˆ¶'};
});
const selectedSymptoms=Array.from(document.querySelectorAll('.symptom-checkbox:checked')).map(cb=>{
const seq=cb.dataset.seq,cd=cb.closest('.symptom-card');
return{
seq:parseInt(seq),symptom:cd.querySelector('label').textContent.replace(/^\[\d+\]/,'').trim(),
durationText:cd.querySelector('.duration-select option:checked').textContent,
severityText:cd.querySelector('.severity-select option:checked').textContent.replace(/ï¼ˆ.*ï¼‰/g,'')
};
});
return{
action:'submitChecklist',
userId:liff.getDecodedIDToken()?.sub||'',
displayName:liffProfile.displayName||'LINEç”¨æˆ¶',
submitTime:new Date().toISOString(),
userName:document.getElementById('user-name').value.trim(),
userAge:document.getElementById('user-age').value.trim(),
userGender:document.getElementById('user-gender').value,
userHeight:document.getElementById('user-height').value.trim()||'',
userWeight:document.getElementById('user-weight').value.trim()||'',
userBp:document.getElementById('user-bp').value.trim()||'',
userGlucose:document.getElementById('user-glucose').value.trim()||'',
userJob:document.getElementById('user-job').value.trim()||'',
selectedSymptoms:JSON.stringify(selectedSymptoms),
// æ–°å¢ï¼šæ˜ç¡®æ ‡è¯†æ•°æ®æ¥æºï¼Œæ–¹ä¾¿GASè¯†åˆ«
dataType:'checklistSubmit'
};
}
function submitChecklistData(data,btn){
console.log("æäº¤æ•¸æ“šï¼ˆå«çœŸå¯¦LINEåç¨±ï¼‰ï¼š",data);
setStatus('æäº¤ä¸­...');
document.getElementById('status').classList.remove('hidden');
$.ajax({
url:GAS_URL,
dataType:'jsonp',
jsonp:'callback',
jsonpCallback:'submitCallback',
timeout:JSONP_TIMEOUT,
data:data,
success:function(resp){
document.getElementById('status').classList.add('hidden');
hideSubmitLoading();
alert('æäº¤æˆåŠŸï¼æ­£åœ¨ç”Ÿæˆå¥åº·å ±å‘Š...');
const rd=organizeReportData({
...data,
userBasicInfo:window.userBasicInfo,
selectedSymptoms:JSON.parse(data.selectedSymptoms)
});
window.reportData=rd;
renderReportSummary(rd);
document.getElementById('success-modal').classList.remove('hidden');
document.getElementById('checklist-section').classList.add('hidden');
document.getElementById('user-info-section').classList.add('hidden');
createFloatingButtons();
document.getElementById('success-modal').scrollIntoView({behavior:'smooth'});
btn.disabled=false;
btn.innerHTML='<i class="fa fa-paper-plane mr-1.5"></i>æäº¤è‡ªæª¢è¡¨';
},
error:function(xhr,status,error){
document.getElementById('status').classList.add('hidden');
hideSubmitLoading();
btn.disabled=false;
btn.innerHTML='<i class="fa fa-paper-plane mr-1.5"></i>æäº¤è‡ªæª¢è¡¨';
console.error("æäº¤å¤±æ•—ï¼š",status,error);
if(status==='timeout'){
showError('æäº¤è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡å¾Œé‡æ–°å˜—è©¦');
}else{
showError(`æäº¤å¤±æ•—ï¼š${error||'æœªçŸ¥ç¶²çµ¡éŒ¯èª¤'}`);
}
}
});
}
function renderReportSummary(reportData){
try{
const summaryContent=document.getElementById('summary-content');
if(!summaryContent)return;
let basicInfoHtml=`
<div class="info-grid grid grid-cols-2 gap-2 text-center mx-auto max-w-md">
  <div class="info-item py-1"><span class="text-slate-500 text-sm">å§“åï¼š</span><span class="font-medium">${reportData.formattedUserInfo.å§“å}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">å¹´é½¡ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.å¹´é½¡}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">æ€§åˆ¥ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.æ€§åˆ¥}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">è·æ¥­ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.è·æ¥­}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">èº«é«˜ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.èº«é«˜}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">é«”é‡ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.é«”é‡}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">è¡€å£“ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.è¡€å£“}</span></div>
  <div class="info-item py-1"><span class="text-slate-500 text-sm">è¡€ç³–ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.è¡€ç³–}</span></div>
</div>
<div class="w-full py-1 text-center mt-1">
  <span class="text-slate-500 text-sm">æäº¤æ™‚é–“ï¼š</span><span class="font-medium">${reportData.formattedUserInfo.æäº¤æ™‚é–“}</span>
</div>
<div class="w-full h-0.5 bg-slate-200/50 my-2 rounded mx-auto max-w-md"></div>
`;
let statsHtml=`
<div class="mb-2 text-center">
  <p class="font-medium text-slate-800 mb-1">ğŸ“Š æ•´é«”çµ±è¨ˆ</p>
  <div class="pl-2 mt-1 space-y-1 inline-block text-left">
    <p>ç¸½ç—‡ç‹€æ•¸ï¼š${reportData.totalSymptomCount} ç¨®</p>
    <p>å·²é¸ç—‡ç‹€æ•¸ï¼š<span class="text-primary font-bold">${reportData.selectedTotal}</span> é …</p>
  </div>
</div>
<div class="w-full h-0.5 bg-slate-200/50 my-2 rounded mx-auto max-w-md"></div>
`;
let topFactorsHtml='';
if(reportData.topFactors.length>0){
topFactorsHtml=`
<div class="mb-2 text-center">
  <p class="font-medium text-slate-800 mb-2">ğŸŒŸ ä¸ƒå¤§å¥åº·è¦ç´ ï¼šä½”æ¯”æœ€é«˜äºŒç¨®</p>
  <div class="pl-2 mt-1 space-y-2 inline-block text-left min-w-[250px]">
    ${reportData.topFactors.map((factor,idx)=>`
      <div class="flex items-center justify-between mb-1">
        <span>${idx+1}. ${factor.name}</span>
        <span class="text-${getFactorColor(factor.key)} font-bold">${factor.percentage}</span>
      </div>
      <div class="w-full bg-slate-200/60 rounded-full h-1.5 mb-2">
        <div class="bg-${getFactorColor(factor.key)} h-1.5 rounded-full" style="width: ${factor.percentage}"></div>
      </div>
    `).join('')}
  </div>
</div>
<div class="w-full h-0.5 bg-slate-200/50 my-2 rounded mx-auto max-w-md"></div>
`;
}
let adviceHtml=`
<div class="text-center">
  <p class="font-medium text-slate-800 mb-2">ğŸ’¡ å¥åº·å»ºè­°</p>
  <div class="pl-2 mt-1 inline-block text-left text-sm text-slate-600 space-y-1">
    <p>1. å„ªå…ˆç•™æ„é«˜ä½”æ¯”å¥åº·è¦ç´ ç›¸é—œç—‡ç‹€</p>
    <p>2. ç—‡ç‹€è‹¥æŒçºŒæˆ–æƒ¡åŒ–ï¼ŒåŠæ—©å°±é†«</p>
    <p>3. ç¶­æŒè¦å¾‹ä½œæ¯èˆ‡å‡è¡¡é£²é£Ÿä»¥æ”¹å–„ç‹€æ…‹</p>
  </div>
</div>
`;
summaryContent.innerHTML=`
<div class="text-center mb-3">
  <h3 class="text-xl font-bold text-slate-800"> ğŸ§¬ å¥åº·è‡ªæª¢å ±å‘Š </h3>
</div>
${basicInfoHtml}
${statsHtml}
${topFactorsHtml}
${adviceHtml}
`;
if(!document.getElementById('screenshot-target')){
const modalContent=document.querySelector('#success-modal .bg-cardBg');
const screenshotTarget=document.createElement('div');
screenshotTarget.id='screenshot-target';
screenshotTarget.className='w-full';
while(modalContent.firstChild){
screenshotTarget.appendChild(modalContent.firstChild);
}
modalContent.appendChild(screenshotTarget);
}
}catch(e){
console.error("æ¸²æŸ“å ±å‘Šæ‘˜è¦å‡ºéŒ¯ï¼š",e);
hideSubmitLoading();
showError('å ±å‘Šç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡æ–°æäº¤');
}
}
function getFactorColor(factorKey){
const colorMap={
'æ°£è¡€':'slate-500',
'å¾ªç’°':'emerald-500',
'æ¯’ç´ ':'amber-500',
'è¡€è„‚':'orange-500',
'å¯’æ¿•':'violet-500',
'å…ç–«':'pink-500',
'æƒ…ç·’':'indigo-500'
};
return colorMap[factorKey]||'primary';
}
async function initLIFF(){
try{
setStatus('æ­£åœ¨åˆå§‹åŒ–LINEç™»éŒ„...');
await liff.init({liffId:LIFF_ID});
if(!liff.isLoggedIn()){
setStatus('è«‹å…ˆç™»éŒ„LINEè³¬è™Ÿ...');
liff.login({redirectUri:window.location.href});
return;
}
const profile=await liff.getProfile();
console.log("LINEç”¨æˆ¶ä¿¡æ¯ï¼š",profile);
setStatus('æ­£åœ¨é©—è­‰æˆæ¬Šç‹€æ…‹...');
const userInfo = await verifyUserFromBackend(profile);
if(!userInfo){
showError('ç”¨æˆ¶æˆæ¬Šé©—è­‰å¤±æ•—ï¼Œè«‹é‡è©¦');
return;
}
document.getElementById('status').classList.add('hidden');
document.getElementById('result-main').textContent=`æ­¡è¿å›ä¾†ï¼Œ${userInfo.displayName}ï¼`;
let expiryText = userInfo.isAdmin 
  ? `${userInfo.expiryDate}ï¼ˆ${userInfo.remainingDays === "æ°¸ä¹…æœ‰æ•ˆ" ? "æ°¸ä¹…æœ‰æ•ˆ" : `${userInfo.remainingDays} `}ï¼‰`
  : "æ™®é€šç”¨æˆ¶ï¼ˆ3æ¬¡ä½¿ç”¨ä¸Šé™ï¼‰";
document.getElementById('result-details').innerHTML=`
<p>ç”¨æˆ¶é¡å‹ï¼š<span class="text-primary font-medium">${userInfo.isAdmin ? "å°ˆæ¥­ç”¨æˆ¶" : "æ™®é€šç”¨æˆ¶"}</span></p>
<p>æœ‰æ•ˆæœŸï¼š<span class="text-primary font-medium">${expiryText}</span></p>
${!userInfo.isAdmin ? `<p>å‰©é¤˜ä½¿ç”¨æ¬¡æ•¸ï¼š<span class="text-primary font-medium">${3 - userInfo.usageCount} æ¬¡</span></p>` : ""}
`;
document.getElementById('result-card').classList.remove('hidden');
document.getElementById('user-info-section').classList.remove('hidden');
initControlButtons();
}catch(error){
console.error("LIFFåˆå§‹åŒ–å¤±æ•—ï¼š",error);
if(error.message.includes('LIFF ID')){
showError('LIFF IDé…ç½®éŒ¯èª¤ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡');
}else{
showError('ç³»çµ±åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹åˆ·æ–°é é¢é‡è©¦');
}
}
}
async function verifyUserFromBackend(profile){
return new Promise((resolve, reject) => {
const userId = liff.getDecodedIDToken()?.sub || '';
const displayName = profile.displayName || 'LINEç”¨æˆ¶';
const data = {
action: 'verifyUser',
userId: userId,
displayName: displayName,
callback: 'verifyCallback',
// æ–°å¢ï¼šæ˜ç¡®æ ‡è¯†éªŒè¯è¯·æ±‚ï¼Œæ–¹ä¾¿GASè¯†åˆ«
dataType: 'userVerify'
};
$.ajax({
url: GAS_URL,
dataType: 'jsonp',
jsonp: 'callback',
jsonpCallback: 'verifyCallback',
timeout: JSONP_TIMEOUT,
data: data,
success: function(resp) {
if(resp.status === "success"){
// è£œå……æœ‰æ•ˆæœŸè¨ˆç®—ï¼Œç¢ºä¿æ•¸æ“šå®Œæ•´
const expiryData = calculateRemainingDaysByDate(resp.expiryDate || PERMANENT_EXPIRY_DATE);
resolve({
...resp,
displayName: displayName,
remainingDays: expiryData.remainingDays,
displayExpiryDate: expiryData.displayDate
});
}else{
showError(resp.message || "ç”¨æˆ¶é©—è­‰å¤±æ•—");
resolve(null);
}
},
error: function(xhr, status, error) {
console.error("ç”¨æˆ¶é©—è­‰è«‹æ±‚å¤±æ•—ï¼š", status, error);
reject(error);
}
});
});
}
window.verifyCallback = function(resp) {
console.log("ç”¨æˆ¶æˆæ¬Šé©—è­‰è¿”å›ï¼š", resp);
};
window.submitCallback = function(resp) {
console.log("è‡ªæª¢è¡¨æäº¤è¿”å›ï¼š", resp);
};
// åˆå§‹åŒ–åŸ·è¡Œ
window.onload = function() {
if(window.liff){
initLIFF();
}else{
// åŠ è¼‰LIFF SDK
const script = document.createElement('script');
script.src = 'https://static.line-scdn.net/liff/edge/2/sdk.js';
script.onload = initLIFF;
script.onerror = () => showError('LIFF SDKåŠ è¼‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡');
document.head.appendChild(script);
}
// åŠ è¼‰jQueryï¼ˆä¾è³´ï¼‰
if(!window.jQuery){
const jqueryScript = document.createElement('script');
jqueryScript.src = 'https://code.jquery.com/jquery-3.7.1.min.js';
jqueryScript.onload = () => console.log('jQueryåŠ è¼‰å®Œæˆ');
jqueryScript.onerror = () => showError('jQueryåŠ è¼‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡');
document.head.appendChild(jqueryScript);
}
};
</script>

</body>
</html>
