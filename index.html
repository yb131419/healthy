<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>健康自檢表 - 您的個人健康評估工具</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36D399',
            accent: '#FF7D00',
            warning: '#FF5630',
            neutral: '#F5F7FA',
            'neutral-dark': '#333F51'
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(22, 93, 255, 0.1), 0 10px 10px -5px rgba(22, 93, 255, 0.04);
      }
      .error-input {
        border-color: #FF5630 !important;
      }
      .error-message {
        color: #FF5630;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }
    }
  </style>
</head>

<body class="font-inter bg-neutral text-neutral-dark min-h-screen">
  <!-- 導航欄 -->
  <header class="sticky top-0 z-50 bg-white/95 shadow-sm backdrop-blur-sm transition-all duration-300">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-heartbeat text-primary text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold text-primary">彥彬 健康自檢表</h1>
      </div>
      <nav class="hidden md:flex items-center space-x-6">
        <a href="#intro" class="text-neutral-dark/80 hover:text-primary transition-colors">簡介</a>
        <a href="#form" class="text-neutral-dark/80 hover:text-primary transition-colors">開始評估</a>
        <a href="#guide" class="text-neutral-dark/80 hover:text-primary transition-colors">填寫指南</a>
        <a href="#result" class="text-neutral-dark/80 hover:text-primary transition-colors">結果解讀</a>
      </nav>
      <button class="md:hidden text-neutral-dark text-xl" id="menuToggle">
        <i class="fa fa-bars"></i>
      </button>
    </div>
    <!-- 移動端菜單 -->
    <div id="mobileMenu" class="hidden md:hidden bg-white border-t">
      <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
        <a href="#intro" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">簡介</a>
        <a href="#form" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">開始評估</a>
        <a href="#guide" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">填寫指南</a>
        <a href="#result" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">結果解讀</a>
      </div>
    </div>
  </header>

  <!-- 英雄區域 -->
  <section class="bg-gradient-to-br from-primary/90 to-primary text-white py-12 md:py-20">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold mb-4 text-shadow leading-tight">
          瞭解您的身體信號
        </h2>
        <p class="text-lg md:text-xl opacity-90 mb-8">
          通過科學的自檢表，發現健康隱患，掌握身體狀況，邁向更健康的生活
        </p>
        <a href="#form" class="inline-block bg-white text-primary font-semibold px-6 py-3 rounded-full shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
          開始我的健康評估 <i class="fa fa-arrow-right ml-2"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- 簡介部分 -->
  <section id="intro" class="py-12 md:py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">為什麼需要健康自檢？</h2>
        <p class="text-lg mb-8 text-neutral-dark/80 leading-relaxed">
          許多健康問題在早期並沒有明顯症狀，等到出現明顯不適時往往已經發展到較嚴重的階段。定期進行健康自檢，
          可以幫助您及時發現身體發出的預警信號，採取相應措施，防患於未然。
        </p>
        
        <div class="grid md:grid-cols-3 gap-6 mb-8">
          <div class="bg-neutral p-6 rounded-xl text-center card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fa fa-stethoscope text-primary text-2xl"></i>
            </div>
            <h3 class="font-semibold text-lg mb-2">早期發現</h3>
            <p class="text-neutral-dark/70">及時捕捉身體異常信號，早發現潛在健康風險</p>
          </div>
          
          <div class="bg-neutral p-6 rounded-xl text-center card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fa fa-line-chart text-primary text-2xl"></i>
            </div>
            <h3 class="font-semibold text-lg mb-2">跟蹤變化</h3>
            <p class="text-neutral-dark/70">記錄健康數據變化，掌握身體狀況發展趨勢</p>
          </div>
          
          <div class="bg-neutral p-6 rounded-xl text-center card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fa fa-medkit text-primary text-2xl"></i>
            </div>
            <h3 class="font-semibold text-lg mb-2">科學調理</h3>
            <p class="text-neutral-dark/70">為健康調理提供依據，實現個性化健康管理</p>
          </div>
        </div>
        
        <div class="bg-primary/5 border-l-4 border-primary p-5 rounded-r-lg">
          <p class="italic text-neutral-dark/80">
            <i class="fa fa-info-circle text-primary mr-2"></i> 
            本表僅作為健康參考，不能替代專業醫療診斷。如有嚴重不適，請及時咨詢醫生。
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- 進度指示器 -->
  <section id="form" class="py-12 bg-neutral">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">健康自檢表單</h2>
        
        <!-- 步驟指示器 -->
        <div class="mb-10">
          <div class="flex items-center justify-between">
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold mb-2">1</div>
              <span class="text-sm md:text-base text-center">基本信息</span>
            </div>
            <div class="flex-1 max-w-[80px] h-1 bg-gray-200 mx-2">
              <div class="step-progress h-full bg-primary" style="width: 0%"></div>
            </div>
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-2">2</div>
              <span class="text-sm md:text-base text-center">身體症狀</span>
            </div>
            <div class="flex-1 max-w-[80px] h-1 bg-gray-200 mx-2">
              <div class="step-progress h-full bg-primary" style="width: 0%"></div>
            </div>
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-2">3</div>
              <span class="text-sm md:text-base text-center">生活習慣</span>
            </div>
            <div class="flex-1 max-w-[80px] h-1 bg-gray-200 mx-2">
              <div class="step-progress h-full bg-primary" style="width: 0%"></div>
            </div>
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-2">4</div>
              <span class="text-sm md:text-base text-center">健康評估</span>
            </div>
          </div>
        </div>
        
        <!-- 表單容器 -->
        <div class="bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
          <!-- 步驟1: 基本信息 -->
          <div class="form-step active" id="step1">
            <h3 class="text-xl font-semibold mb-6 pb-2 border-b">基本信息</h3>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="name" class="block text-sm font-medium text-neutral-dark/80 mb-1">姓名 <span class="text-warning">*</span></label>
                <input type="text" id="name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的姓名">
                <div class="error-message hidden" id="nameError">請輸入您的姓名</div>
              </div>
              
              <div>
                <label for="age" class="block text-sm font-medium text-neutral-dark/80 mb-1">年齡 <span class="text-warning">*</span></label>
                <input type="number" id="age" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的年齡">
                <div class="error-message hidden" id="ageError">請輸入有效的年齡（1-120歲）</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-1">性別 <span class="text-warning">*</span></label>
                <div class="flex space-x-4">
                  <label class="inline-flex items-center">
                    <input type="radio" name="gender" value="male" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">男</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="gender" value="female" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">女</span>
                  </label>
                </div>
                <div class="error-message hidden" id="genderError">請選擇您的性別</div>
              </div>
              
              <div>
                <label for="phone" class="block text-sm font-medium text-neutral-dark/80 mb-1">聯繫電話</label>
                <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的聯繫電話">
              </div>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6 mb-6">
              <div>
                <label for="height" class="block text-sm font-medium text-neutral-dark/80 mb-1">身高 (CM)</label>
                <input type="number" id="height" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="身高">
              </div>
              
              <div>
                <label for="weight" class="block text-sm font-medium text-neutral-dark/80 mb-1">體重 (KG)</label>
                <input type="number" id="weight" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="體重">
              </div>
              
              <div>
                <label for="waist" class="block text-sm font-medium text-neutral-dark/80 mb-1">腰圍 (CM)</label>
                <input type="number" id="waist" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="腰圍">
              </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="bloodPressure" class="block text-sm font-medium text-neutral-dark/80 mb-1">血壓 (mmHg)</label>
                <input type="text" id="bloodPressure" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="如: 120/80">
              </div>
              
              <div>
                <label for="bloodSugar" class="block text-sm font-medium text-neutral-dark/80 mb-1">血糖 (mmol/l)</label>
                <input type="number" step="0.01" id="bloodSugar" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="血糖值">
              </div>
            </div>
            
            <div>
              <label for="occupation" class="block text-sm font-medium text-neutral-dark/80 mb-1">職業</label>
              <input type="text" id="occupation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的職業">
            </div>
          </div>
          
          <!-- 步驟2: 身體症狀 -->
          <div class="form-step hidden" id="step2">
            <h3 class="text-xl font-semibold mb-6 pb-2 border-b">身體症狀自檢</h3>
            <p class="text-neutral-dark/70 mb-6 text-sm">請勾選您目前存在的症狀（可多選）</p>
            
            <!-- 症狀分類標籤 -->
            <div class="flex flex-wrap gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
              <button class="symptom-tab active px-4 py-2 bg-primary text-white rounded-full text-sm whitespace-nowrap" data-category="all">全部症狀</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="head">頭部症狀</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="eye-ear-nose-throat">眼耳鼻喉</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="digestive">消化系統</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="muscle-joint">肌肉關節</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="skin">皮膚問題</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="female">女性健康</button>
              <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="urinary">泌尿生殖</button>
            </div>
            
            <!-- 症狀列表 -->
            <div class="grid md:grid-cols-2 gap-4 mb-6">
              <!-- 頭部症狀 -->
              <div class="symptom-item" data-category="head">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="頭疼/頭暈" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">頭疼/頭暈</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="head">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="頭麻/腦鳴" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">頭麻/腦鳴</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="head">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="嗜睡/易醒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">嗜睡/易醒</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="head">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="失眠/多夢" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">失眠/多夢</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="head">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="偏頭痛/健忘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">偏頭痛/健忘</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="head">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="懶語/結巴" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">懶語/結巴</span>
                </label>
              </div>
              
              <!-- 眼耳鼻喉 -->
              <div class="symptom-item" data-category="eye-ear-nose-throat">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="花眼" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">花眼</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="eye-ear-nose-throat">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="嗓子異物感" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">嗓子異物感</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="eye-ear-nose-throat">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="過敏" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">過敏</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="eye-ear-nose-throat">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="聲音嘶啞" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">聲音嘶啞</span>
                </label>
              </div>
              
              <!-- 消化系統 -->
              <div class="symptom-item" data-category="digestive">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="大便不成形" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">大便不成形</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="digestive">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="便溏不淨/便秘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">便溏不淨/便秘</span>
                </label>
              </div>
              
              <!-- 肌肉關節 -->
              <div class="symptom-item" data-category="muscle-joint">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="腳後跟疼" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">腳後跟疼</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="muscle-joint">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="容易扭傷" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">容易扭傷</span>
                </label>
              </div>
              
              <!-- 皮膚問題 -->
              <div class="symptom-item" data-category="skin">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="身體異味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">身體異味</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="skin">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="皮膚易青/紅點" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">皮膚易青/紅點</span>
                </label>
              </div>
              
              <!-- 女性健康 -->
              <div class="symptom-item" data-category="female">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="乳頭凹陷/流膿" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">乳頭凹陷/流膿</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="female">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="乳房腫塊/增生" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">乳房腫塊/增生</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="female">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="月經少/有塊" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">月經少/有塊</span>
                </label>
              </div>
              
              <div class="symptom-item" data-category="female">
                <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                  <input type="checkbox" name="symptoms" value="經期提前/推後" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                  <span class="ml-2">經期提前/推後</span>
                </label>
              </div>
            </div>
            
            <div class="mt-6">
              <label for="otherSymptoms" class="block text-sm font-medium text-neutral-dark/80 mb-1">其他症狀或病史</label>
              <textarea id="otherSymptoms" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述其他症狀或病史"></textarea>
            </div>
          </div>
          
          <!-- 步驟3: 生活習慣 -->
          <div class="form-step hidden" id="step3">
            <h3 class="text-xl font-semibold mb-6 pb-2 border-b">生活習慣評估</h3>
            <p class="text-neutral-dark/70 mb-6 text-sm">請勾選您存在的不良生活習慣（可多選）</p>
            
            <!-- 生活習慣分類標籤 -->
            <div class="flex flex-wrap gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
              <button class="habit-tab active px-4 py-2 bg-primary text-white rounded-full text-sm whitespace-nowrap" data-category="all">全部習慣</button>
              <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="diet">飲食習慣</button>
              <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="sleep">睡眠習慣</button>
              <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="exercise">運動習慣</button>
              <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="cold">寒濕因素</button>
              <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="emotion">情緒因素</button>
            </div>
            
            <!-- 飲食習慣 -->
            <div class="mb-8">
              <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="diet">飲食習慣</h4>
              <div class="grid md:grid-cols-2 gap-4">
                <div class="habit-item" data-category="diet">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="經常不吃早餐" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">經常不吃早餐</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="diet">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="8點後吃晚飯/吃夜宵" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">8點後吃晚飯/吃夜宵</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="diet">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="吃飯過飽/過急/過快/過少" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">吃飯過飽/過急/過快/過少</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="diet">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="常外面吃飯/點外賣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">常外面吃飯/點外賣</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="diet">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="偏辣/偏咸(口味重)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">偏辣/偏咸(口味重)</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="diet">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="很少吃蔬菜/素食者" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">很少吃蔬菜/素食者</span>
                  </label>
                </div>
              </div>
            </div>
            
            <!-- 睡眠習慣 -->
            <div class="mb-8">
              <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="sleep">睡眠習慣</h4>
              <div class="grid md:grid-cols-2 gap-4">
                <div class="habit-item" data-category="sleep">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="晚過11點睡早9點後起" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">晚過11點睡早9點後起</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="sleep">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="經常上夜班(到天亮)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">經常上夜班(到天亮)</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="sleep">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="睡眠不足7-8小時" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">睡眠不足7-8小時</span>
                  </label>
                </div>
                
                <div class="habit-item" data-category="sleep">
                  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                    <input type="checkbox" name="habits" value="開空調/開窗睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">開空調/開窗睡覺</span>
                  </label>
                </div>
              </div>
            </div>
            
            <!-- 其他習慣 -->
            <div class="grid md:grid-cols-2 gap-6">
              <!-- 運動習慣 -->
              <div>
                <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="exercise">運動習慣</h4>
                <div class="space-y-4">
                  <div class="habit-item" data-category="exercise">
                    <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                      <input type="checkbox" name="habits" value="不運動/少運動/超運動" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                      <span class="ml-2">不運動/少運動/超運動</span>
                    </label>
                  </div>
                  
                  <div class="habit-item" data-category="exercise">
                    <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                      <input type="checkbox" name="habits" value="久站/久坐/久伏案工作" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                      <span class="ml-2">久站/久坐/久伏案工作</span>
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- 情緒因素 -->
              <div>
                <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="emotion">情緒因素</h4>
                <div class="space-y-4">
                  <div class="habit-item" data-category="emotion">
                    <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                      <input type="checkbox" name="habits" value="經常生氣/愛發脾氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                      <span class="ml-2">經常生氣/愛發脾氣</span>
                    </label>
                  </div>
                  
                  <div class="habit-item" data-category="emotion">
                    <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                      <input type="checkbox" name="habits" value="壓力大/精神緊張" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                      <span class="ml-2">壓力大/精神緊張</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 步驟4: 健康評估 -->
          <div class="form-step hidden" id="step4">
            <h3 class="text-xl font-semibold mb-6 pb-2 border-b">健康問題評估</h3>
            
            <div class="space-y-6 mb-8">
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您目前最想解決的健康問題是？ <span class="text-warning">*</span></label>
                <input type="text" id="mainConcern" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述您最關注的健康問題">
                <div class="error-message hidden" id="mainConcernError">請描述您最關注的健康問題</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">這個症狀已經持續多久了？ <span class="text-warning">*</span></label>
                <select id="symptomDuration" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                  <option value="">請選擇</option>
                  <option value="少於1周">少於1周</option>
                  <option value="1-4周">1-4周</option>
                  <option value="1-3個月">1-3個月</option>
                  <option value="3-6個月">3-6個月</option>
                  <option value="6個月-1年">6個月-1年</option>
                  <option value="1-3年">1-3年</option>
                  <option value="3年以上">3年以上</option>
                </select>
                <div class="error-message hidden" id="symptomDurationError">請選擇症狀持續時間</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您認為是什麼原因引起的？</label>
                <textarea id="possibleCauses" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述您認為的可能原因"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">在什麼情況下症狀會加重？</label>
                <textarea id="aggravatingFactors" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述加重症狀的因素"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您之前嘗試過哪些治療或調理方法？</label>
                <textarea id="previousTreatments" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述您之前的治療或調理經歷"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您是否有藥物或食物過敏史？ <span class="text-warning">*</span></label>
                <div class="flex space-x-4 mb-2">
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="none" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">無</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="drug" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">藥物過敏</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="food" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">食物過敏</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="both" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">兩者都有</span>
                  </label>
                </div>
                <div class="error-message hidden" id="allergyHistoryError">請選擇是否有過敏史</div>
                <textarea id="allergyDetails" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="如有，請詳細描述"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您是否做過手術或有既往病史？ <span class="text-warning">*</span></label>
                <div class="flex space-x-4 mb-2">
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="none" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">無</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="surgery" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">做過手術</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="disease" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">有既往病史</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="both" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">兩者都有</span>
                  </label>
                </div>
                <div class="error-message hidden" id="medicalHistoryError">請選擇是否有手術史或既往病史</div>
                <textarea id="medicalDetails" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="如有，請詳細描述"></textarea>
              </div>
            </div>
            
            <div class="bg-primary/5 p-5 rounded-lg">
              <h4 class="font-medium text-primary mb-2">健康宣言</h4>
              <p class="text-sm text-neutral-dark/80 mb-3">
                我已如實填寫以上信息，瞭解本表僅作為健康參考，不能替代專業醫療診斷。
                如有嚴重不適，我會及時咨詢醫生。
              </p>
              <label class="inline-flex items-start mt-2">
                <input type="checkbox" id="healthDeclaration" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                <span class="ml-2 text-sm">我已閱讀並同意以上內容 <span class="text-warning">*</span></span>
              </label>
              <div class="error-message hidden" id="declarationError">請閱讀並同意健康宣言</div>
            </div>
          </div>
        </div>
        
        <!-- 表單導航按鈕 -->
        <div class="flex justify-between">
          <button id="prevBtn" class="px-6 py-3 bg-gray-200 text-neutral-dark rounded-lg hover:bg-gray-300 transition-colors hidden">
            <i class="fa fa-arrow-left mr-2"></i> 上一步
          </button>
          <div class="ml-auto">
            <button id="nextBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
              下一步 <i class="fa fa-arrow-right ml-2"></i>
            </button>
            <button id="submitBtn" class="px-6 py-3 bg-secondary text-white rounded-lg hover:bg-secondary/90 transition-colors hidden">
              提交評估 <i class="fa fa-check ml-2"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- 填寫指南 -->
  <section id="guide" class="py-12 md:py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">填寫指南</h2>
        
        <div class="space-y-8">
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-check-circle text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">如實填寫</h3>
              <p class="text-neutral-dark/70">請根據您的實際情況如實勾選症狀和習慣，信息越準確，評估結果越有參考價值。</p>
            </div>
          </div>
          
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-clock-o text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">耐心完成</h3>
              <p class="text-neutral-dark/70">整個評估過程大約需要15-20分鐘，請預留足夠時間，盡量一次性完成所有問題。</p>
            </div>
          </div>
          
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-question-circle text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">明確症狀</h3>
              <p class="text-neutral-dark/70">如果對某些症狀描述不確定，請根據字面意思理解，或咨詢專業人士後再填寫。</p>
            </div>
          </div>
          
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-refresh text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">定期復查</h3>
              <p class="text-neutral-dark/70">建議每3個月重新評估一次，跟蹤健康變化趨勢，及時調整健康管理方案。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- 結果展示區域 -->
  <section id="result" class="py-12 bg-neutral hidden">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">健康評估結果</h2>
        
        <div class="bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
          <!-- 新增基本資料部分 -->
          <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">基本資料</h3>
            <div id="basicInfo" class="grid md:grid-cols-2 gap-4">
              <!-- 基本資料將在這裡動態顯示 -->
            </div>
          </div>
          
          <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">健康狀況概覽</h3>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div class="bg-neutral p-5 rounded-xl">
                <h4 class="font-medium text-lg mb-3 flex items-center">
                  <i class="fa fa-stethoscope text-primary mr-2"></i> 症狀評估
                </h4>
                <div class="flex items-center">
                  <div class="w-full bg-gray-200 rounded-full h-4 mr-3">
                    <div id="symptomScoreBar" class="bg-primary h-4 rounded-full" style="width: 0%"></div>
                  </div>
                  <span id="symptomCount" class="font-medium">0 項症狀</span>
                </div>
              </div>
              
              <div class="bg-neutral p-5 rounded-xl">
                <h4 class="font-medium text-lg mb-3 flex items-center">
                  <i class="fa fa-balance-scale text-primary mr-2"></i> 習慣評估
                </h4>
                <div class="flex items-center">
                  <div class="w-full bg-gray-200 rounded-full h-4 mr-3">
                    <div id="habitScoreBar" class="bg-warning h-4 rounded-full" style="width: 0%"></div>
                  </div>
                  <span id="habitCount" class="font-medium">0 項不良習慣</span>
                </div>
              </div>
            </div>
            
            <div class="mb-6">
              <h4 class="font-medium text-lg mb-3 flex items-center">
                <i class="fa fa-pie-chart text-primary mr-2"></i> 健康風險分布
              </h4>
              <div class="h-64">
                <canvas id="healthRadarChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">主要健康問題</h3>
            <div id="mainHealthIssues" class="bg-primary/5 p-5 rounded-xl">
              <!-- 結果將在這裡動態顯示 -->
            </div>
          </div>
          
          <div>
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">改善建議</h3>
            <div id="healthRecommendations" class="space-y-4">
              <!-- 建議將在這裡動態顯示 -->
            </div>
          </div>
        </div>
        
        <div class="text-center">
          <button id="restartBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors mr-3">
            <i class="fa fa-refresh mr-2"></i> 重新評估
          </button>
          <button id="downloadReportBtn" class="px-6 py-3 bg-gray-200 text-neutral-dark rounded-lg hover:bg-gray-300 transition-colors">
            <i class="fa fa-download mr-2"></i> 下載圖片
          </button>
        </div>
      </div>
    </div>
  </section>
  
  <!-- 頁腳 -->
  <footer class="bg-neutral-dark text-white py-10">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <div class="grid md:grid-cols-3 gap-8 mb-8">
          <div>
            <h3 class="text-lg font-semibold mb-4 flex items-center">
              <i class="fa fa-heartbeat text-primary mr-2"></i> 健康自檢表
            </h3>
            <p class="text-gray-400 text-sm">
              提供專業的健康自我評估工具，幫助您瞭解身體狀況，預防健康風險。
            </p>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">快速鏈接</h3>
            <ul class="space-y-2 text-sm text-gray-400">
              <li><a href="#intro" class="hover:text-primary transition-colors">關於自檢表</a></li>
              <li><a href="#guide" class="hover:text-primary transition-colors">填寫指南</a></li>
              <li><a href="#result" class="hover:text-primary transition-colors">結果解讀</a></li>
            </ul>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">免責聲明</h3>
            <p class="text-gray-400 text-sm">
              本健康自檢表僅作為健康參考，不能替代專業醫療診斷。如有嚴重不適，請及時咨詢醫生。
            </p>
          </div>
        </div>
        
        <div class="pt-6 border-t border-gray-700 text-center text-gray-500 text-sm">
          <p>© 2025 健康自檢表 - 您的個人健康評估工具</p>
        </div>
      </div>
    </div>
  </footer>
  
  <!-- 成功提交模態框 -->
  <div id="successModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 transform transition-all">
      <div class="text-center">
        <div class="w-16 h-16 bg-secondary/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-check text-secondary text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold mb-2">提交成功！</h3>
        <p class="text-neutral-dark/70 mb-6">
          您的健康評估已完成，正在生成評估報告...
        </p>
        <button id="viewResultBtn" class="w-full py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
          查看評估結果
        </button>
      </div>
    </div>
  </div>

  <script>
   // 當前步驟
// 當前步驟控制
let currentStep = 1;
const totalSteps = 4;

// DOM 元素引用
const menuToggle = document.getElementById('menuToggle');
const mobileMenu = document.getElementById('mobileMenu');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const submitBtn = document.getElementById('submitBtn');
const viewResultBtn = document.getElementById('viewResultBtn');
const restartBtn = document.getElementById('restartBtn');
const downloadReportBtn = document.getElementById('downloadReportBtn');
const successModal = document.getElementById('successModal');
const resultSection = document.getElementById('result');
const healthDeclaration = document.getElementById('healthDeclaration');

// 導航菜單切換
menuToggle.addEventListener('click', () => {
  mobileMenu.classList.toggle('hidden');
});

// 步驟導航控制
prevBtn.addEventListener('click', () => {
  if (currentStep > 1) {
    currentStep--;
    updateFormSteps();
  }
});

nextBtn.addEventListener('click', () => {
  if (validateStep(currentStep)) {
    if (currentStep < totalSteps) {
      currentStep++;
      updateFormSteps();
    }
  }
});

// 表單驗證函數
function validateStep(step) {
  let isValid = true;
  
  // 清除之前的錯誤提示
  document.querySelectorAll('.error-message').forEach(el => {
    el.classList.add('hidden');
  });
  document.querySelectorAll('input, select, textarea').forEach(el => {
    el.classList.remove('error-input');
  });
  
  // 驗證第一步：基本信息
  if (step === 1) {
    const name = document.getElementById('name').value.trim();
    const age = document.getElementById('age').value.trim();
    const genderSelected = document.querySelector('input[name="gender"]:checked');
    
    if (!name) {
      showError('name', '請輸入您的姓名');
      isValid = false;
    }
    
    if (!age || isNaN(age) || age < 1 || age > 120) {
      showError('age', '請輸入有效的年齡（1-120歲）');
      isValid = false;
    }
    
    if (!genderSelected) {
      showError('gender', '請選擇您的性別');
      isValid = false;
    }
  }
  // 驗證第四步：健康評估
  else if (step === 4) {
    const mainConcern = document.getElementById('mainConcern').value.trim();
    const symptomDuration = document.getElementById('symptomDuration').value;
    const allergySelected = document.querySelector('input[name="allergyHistory"]:checked');
    const medicalSelected = document.querySelector('input[name="medicalHistory"]:checked');
    const declarationChecked = document.getElementById('healthDeclaration').checked;
    
    if (!mainConcern) {
      showError('mainConcern', '請描述您最關注的健康問題');
      isValid = false;
    }
    
    if (!symptomDuration) {
      showError('symptomDuration', '請選擇症狀持續時間');
      isValid = false;
    }
    
    if (!allergySelected) {
      showError('allergyHistory', '請選擇是否有過敏史');
      isValid = false;
    }
    
    if (!medicalSelected) {
      showError('medicalHistory', '請選擇是否有手術史或既往病史');
      isValid = false;
    }
    
    if (!declarationChecked) {
      showError('declaration', '請閱讀並同意健康宣言');
      isValid = false;
    }
  }
  
  return isValid;
}

// 顯示錯誤信息
function showError(fieldId, message) {
  const errorElement = document.getElementById(`${fieldId}Error`);
  if (errorElement) {
    errorElement.textContent = message;
    errorElement.classList.remove('hidden');
  }
  
  const inputElement = document.getElementById(fieldId);
  if (inputElement) {
    inputElement.classList.add('error-input');
    inputElement.focus();
  } else {
    const fieldElement = document.querySelector(`input[name="${fieldId}"]`) || 
                        document.querySelector(`input[id="${fieldId}"]`);
    if (fieldElement) {
      fieldElement.closest('div').scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }
}

// 提交表單
submitBtn.addEventListener('click', () => {
  if (validateStep(4)) {
    successModal.classList.remove('hidden');
    setTimeout(() => {
      generateResult();
    }, 1500);
  }
});

// 查看結果
viewResultBtn.addEventListener('click', () => {
  successModal.classList.add('hidden');
  resultSection.classList.remove('hidden');
  resultSection.scrollIntoView({ behavior: 'smooth' });
});

// 重新評估
restartBtn.addEventListener('click', () => {
  // 重置表單
  document.querySelectorAll('input, textarea, select').forEach(element => {
    if (element.type === 'checkbox' || element.type === 'radio') {
      element.checked = false;
    } else {
      element.value = '';
    }
    element.classList.remove('error-input');
  });
  
  // 清除錯誤提示
  document.querySelectorAll('.error-message').forEach(el => {
    el.classList.add('hidden');
  });
  
  // 重置步驟
  currentStep = 1;
  updateFormSteps();
  
  // 隱藏結果區域
  resultSection.classList.add('hidden');
  
  // 滾動到表單頂部
  document.getElementById('form').scrollIntoView({ behavior: 'smooth' });
});

// 下載圖片功能（增強版）
downloadReportBtn.addEventListener('click', async () => {
  try {
    // 顯示加載狀態
    downloadReportBtn.disabled = true;
    downloadReportBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 正在處理...';
    
    // 檢查瀏覽器支持
    if (!window.fetch || !window.FormData) {
      throw new Error('您的瀏覽器版本過舊，請升級瀏覽器後重試');
    }
    
    // 確認 html2canvas 已加載
    if (typeof html2canvas === 'undefined') {
      // 嘗試動態加載html2canvas
      const script = document.createElement('script');
      script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
      script.async = true;
      document.head.appendChild(script);
      
      // 等待加載完成
      await new Promise((resolve, reject) => {
        script.onload = resolve;
        script.onerror = () => reject(new Error('無法加載圖片處理庫，請手動下載'));
      });
    }

    // 獲取健康評估結果區域
    const reportElement = document.querySelector('#result .bg-white.rounded-2xl.shadow-md.p-6');
    if (!reportElement) {
      throw new Error('無法找到評估結果區域，請重新生成報告');
    }

    // 臨時調整樣式
    const originalStyles = {
      padding: reportElement.style.padding,
      boxShadow: reportElement.style.boxShadow
    };
    reportElement.style.padding = '20px';
    reportElement.style.boxShadow = 'none';
    
    // 使用 html2canvas 捕獲區域
    const canvas = await html2canvas(reportElement, {
      useCORS: true,
      allowTaint: false,
      scale: window.devicePixelRatio || 2,
      logging: false,
      scrollY: -window.scrollY // 解決滾動截圖問題
    });
    
    // 恢復原始樣式
    Object.keys(originalStyles).forEach(key => {
      reportElement.style[key] = originalStyles[key];
    });
    
    // 創建圖像URL
    const imageUrl = canvas.toDataURL('image/png');
    
    // 先嘗試直接下載（最穩定方式）
    const downloadLink = document.createElement('a');
    const fileName = `健康評估報告_${new Date().toLocaleDateString().replace(/\//g, '-')}.png`;
    downloadLink.download = fileName;
    downloadLink.href = imageUrl;
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
    
    // 嘗試上傳到imgbb作為額外選項
    try {
      canvas.toBlob(async (blob) => {
        const formData = new FormData();
        formData.append('image', blob, fileName);
        
        // 替換為您自己的API key
        const response = await fetch(`https://api.imgbb.com/1/upload?key=YOUR_API_KEY`, {
          method: 'POST',
          body: formData,
          mode: 'cors',
          headers: {
            'Accept': 'application/json'
          }
        });
        
        const result = await response.json();
        
        if (result.success) {
          setTimeout(() => {
            if (confirm('圖片已成功保存到本地！是否需要獲取在線分享鏈接？')) {
              alert(`在線鏈接：\n${result.data.url}\n\n您可以復制此鏈接進行分享`);
            }
          }, 500);
        }
      });
    } catch (uploadError) {
      console.log('在線上傳功能不可用，已成功保存到本地', uploadError);
    } finally {
      // 恢復按鈕狀態
      downloadReportBtn.disabled = false;
      downloadReportBtn.innerHTML = '<i class="fa fa-download mr-2"></i> 下載圖片';
      alert('圖片已成功保存到本地！');
    }
    
  } catch (error) {
    console.error('處理圖片時出錯:', error);
    downloadReportBtn.disabled = false;
    downloadReportBtn.innerHTML = '<i class="fa fa-download mr-2"></i> 下載圖片';
    
    // 提供不同場景的錯誤提示
    let errorMsg = '處理圖片失敗: ';
    if (error.message.includes('瀏覽器')) {
      errorMsg += '您的瀏覽器版本過舊，建議升級到最新版Chrome或Edge';
    } else if (error.message.includes('評估結果區域')) {
      errorMsg += '請先完成評估並生成結果報告';
    } else {
      errorMsg += error.message + '，請嘗試刷新頁面重試';
    }
    alert(errorMsg);
  }
});

// 添加原生分享功能
function addShareFunctionality() {
  // 檢查瀏覽器是否支持原生分享
  if (navigator.share) {
    // 創建分享按鈕
    const shareBtn = document.createElement('button');
    shareBtn.id = 'shareReportBtn';
    shareBtn.className = 'bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition duration-300 flex items-center';
    shareBtn.innerHTML = '<i class="fa fa-share-alt mr-2"></i> 分享報告';
    
    // 添加到按鈕容器
    const btnContainer = downloadReportBtn.parentElement;
    btnContainer.insertBefore(shareBtn, downloadReportBtn.nextSibling);
    
    // 分享按鈕點擊事件
    shareBtn.addEventListener('click', async () => {
      try {
        // 獲取報告基本信息用於分享
        const name = document.getElementById('name').value || '用戶';
        const shareText = `${name}的健康評估報告，生成於${new Date().toLocaleString()}`;
        
        // 檢查是否有圖片URL可用
        let imageUrl = null;
        if (window.reportImageUrl) {
          // 將dataURL轉換為Blob對象用於分享
          const response = await fetch(window.reportImageUrl);
          const blob = await response.blob();
          const file = new File([blob], '健康評估報告.png', { type: 'image/png' });
          imageUrl = [file];
        }
        
        // 調用原生分享API
        await navigator.share({
          title: '健康評估報告',
          text: shareText,
          url: window.location.href,
          files: imageUrl
        });
        
      } catch (error) {
        console.error('分享失敗:', error);
        if (error.name !== 'AbortError') { // 用戶取消分享不算錯誤
          alert('分享功能暫不可用，請手動分享下載的圖片');
        }
      }
    });
  }
}

// 生成評估結果
function generateResult() {
  // 獲取基本資料
  const name = document.getElementById('name').value || '未填寫';
  const age = document.getElementById('age').value || '未填寫';
  const gender = document.querySelector('input[name="gender"]:checked') 
    ? document.querySelector('input[name="gender"]:checked').value === 'male' ? '男' : '女' 
    : '未填寫';
  const phone = document.getElementById('phone').value || '未填寫';
  const height = document.getElementById('height').value ? `${document.getElementById('height').value} cm` : '未填寫';
  const weight = document.getElementById('weight').value ? `${document.getElementById('weight').value} kg` : '未填寫';
  const waist = document.getElementById('waist').value ? `${document.getElementById('waist').value} cm` : '未填寫';
  const bloodPressure = document.getElementById('bloodPressure').value || '未填寫';
  const bloodSugar = document.getElementById('bloodSugar').value ? `${document.getElementById('bloodSugar').value} mmol/l` : '未填寫';
  const occupation = document.getElementById('occupation').value || '未填寫';
  
  // 計算BMI
  let bmi = '未計算';
  if (document.getElementById('height').value && document.getElementById('weight').value) {
    const h = parseFloat(document.getElementById('height').value) / 100;
    const w = parseFloat(document.getElementById('weight').value);
    if (h > 0) {
      const bmiValue = (w / (h * h)).toFixed(1);
      let bmiStatus = '';
      if (bmiValue < 18.5) bmiStatus = '（偏瘦）';
      else if (bmiValue < 24) bmiStatus = '（正常）';
      else if (bmiValue < 28) bmiStatus = '（超重）';
      else bmiStatus = '（肥胖）';
      bmi = `${bmiValue} ${bmiStatus}`;
    }
  }
  
  // 顯示基本資料
  const basicInfoContainer = document.getElementById('basicInfo');
  basicInfoContainer.innerHTML = `
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>姓名：</strong> ${name}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>年齡：</strong> ${age} 歲</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>性別：</strong> ${gender}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>聯繫電話：</strong> ${phone}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>身高：</strong> ${height}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>體重：</strong> ${weight}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>BMI：</strong> ${bmi}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>腰圍：</strong> ${waist}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>血壓：</strong> ${bloodPressure}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg">
      <p class="text-sm"><strong>血糖：</strong> ${bloodSugar}</p>
    </div>
    <div class="p-3 border border-gray-100 rounded-lg md:col-span-2">
      <p class="text-sm"><strong>職業：</strong> ${occupation}</p>
    </div>
  `;
  
  // 獲取選中的症狀和習慣
  const selectedSymptoms = Array.from(document.querySelectorAll('input[name="symptoms"]:checked')).map(checkbox => checkbox.value);
  const symptomCount = selectedSymptoms.length;
  const selectedHabits = Array.from(document.querySelectorAll('input[name="habits"]:checked')).map(checkbox => checkbox.value);
  const habitCount = selectedHabits.length;
  
  // 獲取主要健康問題
  const mainConcern = document.getElementById('mainConcern').value || '未明確說明';
  const symptomDuration = document.getElementById('symptomDuration').value || '未說明';
  const possibleCauses = document.getElementById('possibleCauses').value || '未說明';
  
  // 更新結果數據
  document.getElementById('symptomCount').textContent = `${symptomCount} 項症狀`;
  document.getElementById('habitCount').textContent = `${habitCount} 項不良習慣`;
  
  // 設置進度條
  const symptomPercentage = Math.min(100, (symptomCount / 20) * 100);
  const habitPercentage = Math.min(100, (habitCount / 15) * 100);
  
  document.getElementById('symptomScoreBar').style.width = `${symptomPercentage}%`;
  document.getElementById('habitScoreBar').style.width = `${habitPercentage}%`;
  
  // 顯示主要健康問題
  const mainIssuesContainer = document.getElementById('mainHealthIssues');
  mainIssuesContainer.innerHTML = `
    <p class="mb-3"><strong>主要關注問題：</strong> ${mainConcern}</p>
    <p class="mb-3"><strong>症狀持續時間：</strong> ${symptomDuration}</p>
    <p class="mb-3"><strong>可能原因：</strong> ${possibleCauses}</p>
    ${symptomCount > 0 ? `<p><strong>主要症狀：</strong> ${selectedSymptoms.slice(0, 3).join('、')} ${symptomCount > 3 ? `等${symptomCount}項症狀` : ''}</p>` : ''}
  `;
  
  // 生成改善建議
  const recommendationsContainer = document.getElementById('healthRecommendations');
  recommendationsContainer.innerHTML = '';
  
  // 根據症狀生成建議
  if (selectedSymptoms.length > 0) {
    recommendationsContainer.innerHTML += `
      <div class="bg-neutral p-4 rounded-lg mb-3">
        <h4 class="font-medium text-primary mb-2">症狀改善建議</h4>
        <p class="text-sm text-neutral-dark/80">針對您的症狀，建議您：</p>
        <ul class="mt-2 text-sm text-neutral-dark/80 space-y-1 list-disc pl-5">
          <li>及時記錄症狀變化，觀察加重或緩解因素</li>
          <li>保持規律作息，避免過度勞累</li>
          <li>如症狀持續或加重，請咨詢專業醫生進行進一步檢查</li>
        </ul>
      </div>
    `;
  }
  
  // 根據習慣生成建議
  if (selectedHabits.length > 0) {
    recommendationsContainer.innerHTML += `
      <div class="bg-neutral p-4 rounded-lg mb-3">
        <h4 class="font-medium text-primary mb-2">生活習慣改善建議</h4>
        <p class="text-sm text-neutral-dark/80">針對您的不良生活習慣，建議您：</p>
        <ul class="mt-2 text-sm text-neutral-dark/80 space-y-1 list-disc pl-5">
          <li>保持規律飲食，定時定量，避免暴飲暴食</li>
          <li>保證充足睡眠，盡量在晚上11點前入睡</li>
          <li>適當增加運動量，每周至少進行3-5次有氧運動</li>
          <li>學會調節情緒，保持積極樂觀的心態</li>
        </ul>
      </div>
    `;
  }
  
  // 通用健康建議
  recommendationsContainer.innerHTML += `
    <div class="bg-neutral p-4 rounded-lg">
      <h4 class="font-medium text-primary mb-2">通用健康建議</h4>
      <ul class="text-sm text-neutral-dark/80 space-y-1 list-disc pl-5">
        <li>保持均衡飲食，多吃蔬菜水果，減少高脂高糖食物攝入</li>
        <li>定期進行健康體檢，及時發現潛在健康風險</li>
        <li>戒煙限酒，減少對身體的傷害</li>
        <li>保持良好心態，學會應對壓力和情緒管理</li>
      </ul>
    </div>
  `;
  
  // 保存圖片URL用於分享
  setTimeout(() => {
    html2canvas(document.querySelector('#result .bg-white.rounded-2xl.shadow-md.p-6'), {
      useCORS: true,
      scale: 1
    }).then(canvas => {
      window.reportImageUrl = canvas.toDataURL('image/png');
    });
  }, 1000);
}

// 更新表單步驟顯示
function updateFormSteps() {
  // 隱藏所有步驟
  document.querySelectorAll('.form-step').forEach(step => {
    step.classList.add('hidden');
    step.classList.remove('active');
  });
  
  // 顯示當前步驟
  document.getElementById(`step${currentStep}`).classList.remove('hidden');
  document.getElementById(`step${currentStep}`).classList.add('active');
  
  // 更新步驟指示器
  document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
    if (index + 1 < currentStep) {
      indicator.classList.remove('bg-gray-200', 'text-gray-500');
      indicator.classList.add('bg-primary', 'text-white');
    } else if (index + 1 === currentStep) {
      indicator.classList.remove('bg-gray-200', 'text-gray-500');
      indicator.classList.add('bg-primary', 'text-white');
    } else {
      indicator.classList.remove('bg-primary', 'text-white');
      indicator.classList.add('bg-gray-200', 'text-gray-500');
    }
  });
  
  // 更新按鈕顯示
  if (currentStep === 1) {
    prevBtn.classList.add('hidden');
  } else {
    prevBtn.classList.remove('hidden');
  }
  
  if (currentStep === totalSteps) {
    nextBtn.classList.add('hidden');
    submitBtn.classList.remove('hidden');
  } else {
    nextBtn.classList.remove('hidden');
    submitBtn.classList.add('hidden');
  }
  
  // 滾動到表單頂部
  document.getElementById('form').scrollIntoView({ behavior: 'smooth' });
}

// 症狀分類篩選
document.querySelectorAll('.symptom-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    // 更新標籤樣式
    document.querySelectorAll('.symptom-tab').forEach(t => {
      t.classList.remove('active', 'bg-primary', 'text-white');
      t.classList.add('bg-gray-200', 'hover:bg-gray-300');
    });
    tab.classList.add('active', 'bg-primary', 'text-white');
    tab.classList.remove('bg-gray-200', 'hover:bg-gray-300');
    
    const category = tab.getAttribute('data-category');
    
    // 篩選症狀
    document.querySelectorAll('.symptom-item').forEach(item => {
      if (category === 'all' || item.getAttribute('data-category') === category) {
        item.style.display = 'block';
      } else {
        item.style.display = 'none';
      }
    });
  });
});

// 頁面加載完成後初始化
window.addEventListener('load', () => {
  addShareFunctionality();
  updateFormSteps();
});


  </script>
</body>
</html>
